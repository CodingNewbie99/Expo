---
title: Run E2E tests on EAS Build
sidebar_title: Run E2E tests
description: Learn how to set up and run E2E tests on EAS Build with Maestro.
---

import { GithubIcon } from '@expo/styleguide-icons/custom/GithubIcon';

import { BoxLink } from '~/ui/components/BoxLink';
import { Collapsible } from '~/ui/components/Collapsible';
import { ContentSpotlight } from '~/ui/components/ContentSpotlight';
import { Terminal, DiffBlock } from '~/ui/components/Snippet';
import { Step } from '~/ui/components/Step';

> **Warning** This guide will evolve over time as support for testing workflows in EAS Build improves.

In this guide, you will learn how to run E2E tests on EAS Build using one of the most popular tools for running E2E tests in mobile apps -  [Maestro](https://maestro.mobile.dev/).
In the following steps, we will try to show you using an example how you can configure your EAS Build Maestro E2E tests workflow today:

<Step label="1">
### Initialize a new project

You can skip this step if you already have an existing Expo project.

Start with the following commands to create a new project:

<Terminal
  cmd={[
    '# Initialize a new project',
    '$ npx create-expo-app@latest eas-tests-example',
    '# Move into the project directory',
    '$ cd eas-tests-example',
  ]}
/>
</Step>

<Step label="2">
### Configure EAS Build

You can skip this step if you already have EAS Build configured for your project.

The following command creates a new project on Expo servers for your app and creates [**eas.json**](/build/eas-json/) in the project's root directory:

<Terminal
  cmd={[
    '$ npx eas-cli@latest init',
    '$ npx eas-cli@latest build:configure',
  ]}
/>
</Step>

<Step label="3">
### Add example Maestro test cases

> **Warning** The example flows assume that the app we want to test is an example Expo app created using the default template. If you are using your real-life app, you will need to adjust the flows to match your app's UI.

This is how the UI of the app created from the default Expo template looks like:

<div style={{ display: 'flex', justifyContent: 'center' }}>
  <ContentSpotlight
    src="/static/images/eas-build/tests/01-home.png"
    className="max-w-[400px]"
  />
  <ContentSpotlight src="/static/images/eas-build/tests/02-explore.png" className="max-w-[400px]" />
</div>

We will now create two simple Maestro flows for the example app to show you the general idea.
If you want to learn more about Maestro flows and how to write them, check out the [Maestro documentation](https://maestro.mobile.dev).

To do it create a directory **maestro** at the same level as **eas.json**.
For example, if the **eas.json** file is at the root of your project, create the directory at that level.

Inside it, you can create a new flow called **home.yaml**. This flow will launch the app and assert that the text "Welcome!" is visible on the home screen.

```yaml maestro/home.yaml
appId: dev.expo.eastestsexample # This is an example app id, replace it with your app id!
---
- launchApp
- assertVisible: "Welcome!"
```

Next, create a new flow called **expand_test.yaml**. This flow will open the "Explore" screen, click on the "File-based routing" collapsible and assert that the text "This app has two screens" is visible on the screen.

```yaml maestro/expand_test.yaml
appId: dev.expo.eastestsexample # This is an example app id, replace it with your app id!
---
- launchApp
- tapOn: "Explore.*"
- tapOn: ".*File-based routing"
- assertVisible: "This app has two screens.*"

```

</Step>

<Step label="4">
### Create custom build workflow for running Maestro E2E tests

The easiest way to run Maestro E2E tests on EAS Build is to create a [custom build workflow](/custom-builds/get-started/).
This workflow will build your app and run the Maestro tests on it.

To do it you must add a custom build config file in your project. Create a directory **.eas/build** at the same level as **eas.json**.
For example, if the **eas.json** file is at the root of your project, create the directory at that level.
The path and the name of both directories are important for EAS Build to identify that a project contains a custom build config.

Inside it, you can create a new config file called **build-and-maestro-test.yml**.
This file defines the custom build workflow config that you want to run.
Workflow contains steps that are executed during the custom build process.
This custom build config will execute the [`eas/build`](custom-builds/schema/#easbuild) custom function group to create a build and then the [`eas/maestro_test`](custom-builds/schema/#easmaestro_test) all-in-one custom function group that installs Maestro, prepares a testing environment (Android Emulator or iOS Simulator) and tests the app using flows specified by the `flow_path` input.

```yaml .eas/build/build-and-maestro-test.yml
build:
  name: Create a build and run Maestro tests on it
  steps:
    - eas/build
    - eas/maestro_test:
        inputs:
          flow_path: |
            maestro/home.yaml
            maestro/expand_test.yaml
```

Now let's modify your **eas.json** by adding a new [build profile](/build/eas-json/#build-profiles) called `build-and-maestro-test` that will be used to run the custom build config from the **build-and-maestro-test.yml** file.
This configuration will build the simulator/emulator version of your app and run the Maestro tests on it.

> **Warning** We have observed that Maestro tests often time out if run on images with Xcode 15.0 or 15.2. Please use the `latest` image to avoid any issues.

```json eas.json
{
  ...,
  "build": {
    ...,
    "build-and-maestro-test": {
      "withoutCredentials": true,
      "config": "build-and-maestro-test.yml",
      "android": {
        "buildType": "apk",
        "image": "latest"
      },
      "ios": {
        "simulator": true,
        "image": "latest"
      }
    }
  },
  ...
}
```
</Step>

<Step label="5">
### Build your app and run E2E tests on EAS Build

To execute a custom build using the `build-and-maestro-test` profile that will build your app and run the Maestro E2E tests afterward, run the following command:

<Terminal cmd={['$ npx eas-cli@latest build --profile build-and-maestro-test']} />

<ContentSpotlight
  alt="Logs of successful Maestro tests"
  src="/static/images/eas-build/tests/03-logs.png"
  className="max-w-[480px]"
/>

Any Maestro artifacts including screenshots taken when flow fails that are saved at `/Users/expo/.maestro/tests` (the default destination) will be automatically uploaded as build artifacts. You can download them from the build page.

<ContentSpotlight
  alt="Failed Maestro tests artifacts"
  src="/static/images/eas-build/tests/04-artifacts.png"
  className="max-w-[480px]"
/>
</Step>

If you want to build more advanced custom builds workflows check the [custom build schema reference](/custom-builds/schema) for more information.