---
title: Testing React Server Components
sidebar_title: Testing RSC
description: Learn about writing unit tests for React and React Native Server Components in Expo.
platforms: ['android', 'ios', 'web']
---

> This guide refers to the experimental feature React Server Components which is still in development.

React Server Components (RSC) are a new feature in React that allows you to build components that render on the server and can be hydrated on the client.

Expo has support for testing React Server Components in your project.

## Jest Testing

Unlike client-based Jest testing, React Server Components run in a Node.js environment, meaning you can more closely emulate the server-side rendering environment with Jest on its own.

### Setup

While standard server rendering is web-only, Expo's universal React Server Components bundle custom server renderers for each platform. This means platform-extensions like `*.ios.js` and `*.native.ts` will be resolved when writing server components for an iOS app.

`jest-expo` provides a couple different presets for testing server components:

- `jest-expo/rsc/web`: An Android-only runner for React Server Components. Uses `*.web.js` and `*.js` files.
- `jest-expo/rsc/ios`: An iOS-only runner for React Server Components. Uses `*.ios.js`, `*.native.js`, and `*.js` files.
- `jest-expo/rsc/android`: An Android-only runner for React Server Components. Uses `*.android.js`, `*.native.js`, and `*.js` files.
- `jest-expo/rsc`: A multi-runner which combines the above runners.

We recommend creating a `jest-rsc.config.js` file in your project root to configure Jest for React Server Components:

```js jest-rsc.config.js
module.exports = require('jest-expo/rsc/jest-preset');
```

Then you can add a script like `test:rsc` to your `package.json`:

```json package.json
{
  "scripts": {
    "test:rsc": "jest --config jest-rsc.config.js"
  }
}
```

### Writing tests

Tests should be written in a `__rsc_tests__` directory to prevent Jest from running your client tests on the server.

```js __rsc_tests__/my-component.test.ts
/// <reference types="jest-expo/rsc/expect" />

import { LinearGradient } from 'expo-linear-gradient';

it(`renders to RSC`, async () => {
  const jsx = (
    <LinearGradient
      colors={['cyan', '#ff00ff', 'rgba(0,0,0,0)', 'rgba(0,255,255,0.5)']}
      testID="gradient"
    />
  );

  await expect(jsx).toMatchFlight(`1:I["src/LinearGradient.tsx",[],"LinearGradient"]
0:["$","$L1",null,{"colors":["cyan","#ff00ff","rgba(0,0,0,0)","rgba(0,255,255,0.5)"],"testID":"gradient"},null]`);
});
```

Any code you import in your tests will be run in the server environment, so you can import server-only modules like `react-server` and `server-only`. This is useful for determining if a library is compatible with React Server Components.

### Custom expect matchers

Jest Expo for RSC adds a couple of custom matchers to Jest's expect:

- `toMatchFlight`: Render a JSX element using a pseudo-implementation of the render in Expo CLI and compare to a flight string.
- `toMatchFlightSnapshot`: Same as `toMatchFlight` but saves the flight string to a snapshot file.

Behind the scenes, these methods are performing part of the framework operation required to render React Server Components. The component is streamed to a string and compared all at once. You can alternatively stream it manually to observe the progress.

If a component fails to render, the matcher will throw an error to fail the test. In reality, an `E:` line will be present in your flight string, this will be sent to the client where the error will end up being thrown.

### Running tests

You can run your tests with the `test:rsc` script:

```sh
yarn test:rsc --watch
```

If you're using the multi-runner, you can select a specific project using the `--selectProjects` flag. The following example only runs the web platform:

```sh
yarn test:rsc --watch --selectProjects rsc/web
```

### Environments

In a React Server Components bundling environment, you can import files like

## Tips

Use the `server-only` and `client-only` modules to assert that a module should not be imported on the client or server:

```js my-module.js
import 'server-only';
```

React Server Components support package exports by default, you can use the `react-server` condition to change what file is imported from a module:

```json package.json
{
  "exports": {
    ".": {
      "react-server": "./index.react-server.js",
      "default": "./index.js"
    }
  }
}
```

When a process is bundling for React Server Components, all modules are bundled in React Server-mode and you opt-out with the `"use client"` directive. When `"use client"` is found, the module becomes an async reference to the client module. `"use server"` is not the opposite of `"use client"`, it is instead used to define React Server Actions.
