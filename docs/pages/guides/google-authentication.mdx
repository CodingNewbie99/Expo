---
title: Authentication with Google and AuthSession API
sidebar_title: Using Google Authentication
description: A guide on setting up and using Google authentication with AuthSession API in your Expo app.
---

import { Terminal } from '~/ui/components/Snippet';
import { Tabs, Tab } from '~/ui/components/Tabs';
import { Collapsible } from '~/ui/components/Collapsible';
import { CODE } from '~/ui/components/Text';

AuthSession API allows [browser-based authentication](/versions/latest/sdk/auth-session/#how-web-browser-based-authentication-flows-work) (using OAuth or OpenID Connect) to your project for Android, iOS, and the web. This guide provides steps on using the API with Google as one of the most popular providers.

## Installing libraries

To use AuthSession API, you'll need to install the following packages in your project:

<Terminal cmd={['$ npx expo install expo-auth-session expo-random expo-web-browser']} />

## Getting credentials

You'll need to provide a Google OAuth client ID to use Google as a login provider. To create a client ID, go to your Google Cloud project's [Credentials page](https://console.developers.google.com/apis/credentials). If you don't have an existing project, create a [new project](https://console.cloud.google.com/projectcreate).

There are four types of client IDs you can provide to the AuthSession API depending on the type of platform or development phase you are building your project for:

- `androidClientId` for Android production apps.
- `iosClientId` for iOS production apps.
- `expoClientId` for Expo Go on Android and iOS. Suitable for testing.
- `webClientId` for web apps used in the browser.

### Setting up consent screen

On the Credentials page, click the **Create credentials** button, select **OAuth client ID** and then click **Configure Consent screen**. You will be prompted to select properties such as **User Type** and other app-related information on this page. Continue the steps there and proceed with the next step when you are done.

### Creating client IDs

<Tabs>

<Tab label="Android">

> The steps described below do not work with Expo Go. They are used when [creating a development build](/development/create-development-builds/) and production apps.

For Android, install the [`expo-application`](/versions/latest/sdk/application/) in your project. It is a peer dependency for `expo-auth-session`. Open the terminal window and run the following command:

<Terminal cmd={['$ npx expo install expo-application']} />

Create a [`androidClientId`](/versions/latest/sdk/auth-session/#googleauthrequestconfig--properties) by following the steps below from the Google Cloud console:

- In the Google Cloud console, go to **Credentials** > **Create OAuth client** page.
- For **Application type**, select **Android** from the dropdown menu.
- For **Name**, enter the name such as **Android Client ID** to identify different client IDs in case you have more than one for multiple platforms.
- Under **Package name**, enter the package name of your app. This is the same package name you have set up in the Expo config file under [`android.package`](/versions/latest/config/app/#package) field, for example, `com.example.myapp`.
- Under **SHA-1 certificate fingerprint**, you'll need to add the signing certificate value. To get this value:
  - In the terminal window, run `eas credentials -p android`, then select the build profile. For example, if you are generating the credential for development, select the build profile for it.
  - Select **Keystore: Manage everything needed to build your project** > **Set up a new keystore** > select the default value for **Assign a name to your build credentials** > press <kbd>Y</kbd> to **Generate a new Android Keystore**.
  - This will generate a new keystore and print the SHA-1 certificate fingerprint. Copy the value of **SHA1 Fingerprint** and paste it into the Google Cloud console.
- Click **Save**.

> Whenever you change values in the Expo config file, you'll need to rebuild the native app.

</Tab>

<Tab label="iOS">

> The steps described below do not work with Expo Go. They are used when [creating a development build](/development/create-development-builds/) and production apps.

Create a [`iosClientId`](/versions/latest/sdk/auth-session/#googleauthrequestconfig--properties) by following the steps below from the Google Cloud console:

- In the Google Cloud console, go to **Credentials** > **Create OAuth client** page.
- For **Application type**, select **iOS** from the dropdown menu.
- For **Name**, enter the name such as **iOS Client ID** to identify different client IDs in case you have more than one for multiple platforms.
- Under **Bundle ID**, enter the bundle ID of your app. This is the same bundler identifier you have set up in the Expo config file under [`ios.bundleIdentifier`](/versions/latest/config/app/#bundleidentifier) field, for example, `com.example.myapp`.
- Click **Save**.

> Whenever you change values in the Expo config file, you'll need to rebuild the native app.

</Tab>

<Tab label='Expo Go'>

> Testing with Expo Go uses web login instead of native authentication.

Create a [`expoClientId`](/versions/latest/sdk/auth-session/#googleauthrequestconfig--properties) by following the steps below from the Google Cloud console. It is a proxy client ID used in Expo Go for testing Android and iOS.

- In the terminal window, log in to your Expo account by running `npx expo login` if you haven't already.
- In the Google Cloud console, go to **Credentials** > **Create OAuth client** page.
- For **Application type**, select **Web application** from the dropdown menu.
- For **Name**, enter the name such as **Expo Go Proxy** to identify different client IDs in case you have more than one for multiple platforms.
- For **Authorized JavaScript origins**, add the URI: `https://auth.expo.io`.
- For **Authorized redirect URIs**, add the URI: `https://auth.expo.io/@your-username/your-project-slug`. Replace `your-username` with your Expo account's username and `your-project-slug` with your project's slug. You can find the project's slug in the Expo config file on the [`slug`](/versions/latest/config/app/#slug) field.
- Click **Save**.

After completing the above steps, you'll get the client ID which you can use as `expoClientId` in your project.

> For more information, see what [`auth.expo.io`](/versions/latest/sdk/auth-session/#what-authexpoio-does-for-you) is and how it makes redirect URL allowlists easier to manage for development and working in teams.

</Tab>

<Tab label="Web">

Create a [`webClientId`](/versions/latest/sdk/auth-session/#googleauthrequestconfig--properties) by following the steps below from the Google Cloud console:

- In the Google Cloud console, go to **Credentials** > **Create OAuth client** page.
- For **Name**, enter the name such as **Web client ID** to identify different client IDs in case you have more than one for multiple platforms.
- For **Authorized JavaScript origins**, add the URI: `https://localhost:19006` and `https://yourwebsite.com`.
- For **Authorized redirect URIs**, add the URI: `https://localhost:19006` and `https://yourwebsite.com`.

</Tab>

</Tabs>

## Adding scheme

For development builds apps and production apps, you'll need to set [`scheme`](/versions/latest/config/app/#scheme) in the Expo config file. It is required for the authentication flow to complete the process and redirect the user back to the app. This is done by deep linking back to the app.

{/* prettier-ignore */}
```json app.json
{
  "expo": {
    /* @hide ... */ /* @end */
    "scheme": "yourscheme"
    /* @hide ... */ /* @end */
  }
}
```

If you do not provide a value for the `scheme`, the authentication flow will complete, however, the user will not be redirected back to the app. They will have to manually exit the authentication modal which will result in rejection.

## Using AuthSession API

The AuthSession API requires the following rules to apply in your project's code:

- `WebBrowser.maybeCompleteAuthSession()` is used to dismiss the modal when the authentication session is completed automatically. It must be invoked. If you don't invoke this method, the modal will remain open.
- [`Google.useAuthRequest`](/versions/latest/sdk/auth-session/#useauthrequest) hook provides instances and a method to invoke an auth session. It allows for async setup, which means that the mobile web browsers won't block the request. It also accepts an object of client IDs that are generated in the Google Cloud console for supported platforms. It a
- The login button must be disabled until the request is loaded asynchronously. This is done by passing the `request` object from the `useAuthRequest` hook to the `disabled` prop of the component.
- The `promptAsync()` method prompts the user to authenticate using a modal.

### Minimal working example

Add or modify the following example in your project to use AuthSession API with Google provider:

{/* prettier-ignore */}
```jsx App.js
import { useEffect, useState } from "react";
import { StyleSheet, Text, View, Button } from "react-native";
import * as WebBrowser from "expo-web-browser";
import * as Google from "expo-auth-session/providers/google";

/* @info This automatically dismisses the modal when an auth session is completed. If it is not provided, the popup window will remain open. */
WebBrowser.maybeCompleteAuthSession();
/* @end */

export default function App() {
  /* @info Define separate state variables to store access token and user information on authorization.*/
  const [token, setToken] = useState("");
  const [userInfo, setUserInfo] = useState(null);
  /* @end */

  /* @info The useAuthRequest hook provides instances and methods to invoke an auth session. It also accepts an object of client IDs for supported platforms.*/
  const [request, response, promptAsync] = Google.useAuthRequest({
    expoClientId: "GOOGLE_GUID.apps.googleusercontent.com",
    iosClientId: "GOOGLE_GUID.apps.googleusercontent.com",
    androidClientId: "GOOGLE_GUID.apps.googleusercontent.com",
    webClientId: "GOOGLE_GUID.apps.googleusercontent.com",
  });
  /* @end */

  useEffect(() => {
    if (response?.type === "success") {
      setToken(response.authentication.accessToken);
      getUserInfo();
    }
  }, [response, token]);

  const getUserInfo = async () => {
    try {
      const response = await fetch(
        /* @info The Google API endpoint to fetch user information. */
        "https://www.googleapis.com/userinfo/v2/me",
        /* @end */
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );

      const user = await response.json();
      setUserInfo(user);
    } catch (error) {
      // Add your own error handler here
    }
  };

  return (
    <View style={styles.container}>
      {userInfo === null ? (
        <Button
          title="Sign in with Google"
          /* @info The button is disabled until the request is loaded asynchronously.*/
          disabled={!request}
          /* @end */
          onPress={() => {
            /* @info Prompt the user to authenticate in a user interaction or web browsers will block it.*/
            promptAsync();
            /* @end */
          }}
        />
      ) : (
        <Text style={styles.text}>{userInfo.name}</Text>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#fff",
    alignItems: "center",
    justifyContent: "center",
  },
  text: {
    fontSize: 20,
    fontWeight: "bold",
  },
});
```

## Testing your app

**For development builds**, see [Use development builds](/development/use-development-builds/#start-the-development-server) for further instructions on how to start the development server or [`npx expo run:android` or `npx expo run:ios`](/workflow/expo-cli/#compiling) command to test it locally.

**For testing the web app**, start your project with the following command:

<Terminal cmd={['$ npx expo start --web --https']} />

## Troubleshooting

<Collapsible summary={<>On iOS, getting <CODE>Error 401: invalid_client The OAuth client was not found</CODE></>}>

Make sure that you have added the correct `iosClientId` in the `Google.useAuthRequest` hook and follow the pattern: `GOOGLE_GUID.apps.googleusercontent.com` where `GOOGLE_GUID` is the unique ID generated.

</Collapsible>

<Collapsible summary="URI scheme in bare workflow">

For development builds or projects using EAS, the URI scheme is automatically added.

For bare workflow, your project needs to conform to the URI scheme matching your `android.package` for Android and `ios.bundleIdentifier` for iOS. You can do that by running the following command for each platform:

<Tabs>

<Tab label="Android">

<Terminal cmd={['$ npx uri-scheme add your-android.package --android']} />

</Tab>

<Tab label="iOS">

<Terminal cmd={['$ npx uri-scheme add your-ios.bundleIdentifier --ios']} />

</Tab>

</Tabs>

</Collapsible>

## More

- [AuthSession API reference](/versions/latest/sdk/auth-session/)
- [How browser-based authentication works?](/versions/latest/sdk/auth-session/#how-web-browser-based-authentication-flows-work)
- [Google authentication provider reference](/versions/latest/sdk/auth-session/#google)
