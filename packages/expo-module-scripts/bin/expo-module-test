#!/usr/bin/env node
'use strict';

const { commandRunner, getArgs } = require("../util/commandUtils");
const fs = require('fs');
const path = require('path');

let args = getArgs();

if (args[0] === 'plugin') {
  const pluginDir = path.join(process.cwd(), 'plugin');
  const configPath = path.join(pluginDir, 'jest.config.js');
  if (fs.existsSync(configPath)) {
    args = ['--rootDir', pluginDir, '--config', configPath, ...args.splice(1)]
  } else {
    args = ['--rootDir', pluginDir, ...args.splice(1)]
  }
}

if (!process.env.CI && !process.env.EXPO_NONINTERACTIVE) {
  args = [...args, '--watch']
}

commandRunner(path.join(__dirname, 'expo-module-jest'), args);