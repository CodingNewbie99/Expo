{"version":3,"file":"Bitcode.js","names":["_Xcodeproj","data","require","_applePlugins","_warnings","withBitcode","applePlatform","config","withXcodeProject","modResults","setBitcodeWithConfig","project","exports","withCustomBitcode","bitcode","setBitcode","getBitcode","isDefaultBehavior","targetName","undefined","isBitcodeEnabled","configs","Object","entries","pbxXCBuildConfigurationSection","filter","isNotComment","hasConfiguration","find","configuration","name","addBuildProperty","names","Set","map","sort","addWarningForPlatform","join"],"sources":["../../src/apple/Bitcode.ts"],"sourcesContent":["import { ExpoConfig } from '@expo/config-types';\nimport { XcodeProject } from 'xcode';\n\nimport { isNotComment } from './utils/Xcodeproj';\nimport { ConfigPlugin } from '../Plugin.types';\nimport { withXcodeProject } from '../plugins/apple-plugins';\nimport { addWarningForPlatform } from '../utils/warnings';\n\nexport type Bitcode = NonNullable<ExpoConfig['ios' | 'macos']>['bitcode'];\n\n/**\n * Plugin to set a bitcode preference for the Xcode project\n * based on the project's Expo config `ios.bitcode` or `macos.bitcode` value.\n */\nexport const withBitcode: (applePlatform: 'ios' | 'macos') => ConfigPlugin =\n  (applePlatform: 'ios' | 'macos') => (config) => {\n    return withXcodeProject(applePlatform)(config, async (config) => {\n      config.modResults = await setBitcodeWithConfig(applePlatform)(config, {\n        project: config.modResults,\n      });\n      return config;\n    });\n  };\n\n/**\n * Plugin to set a custom bitcode preference for the Xcode project.\n * Does not read from the Expo config `ios.bitcode` or `macos.bitcode`.\n *\n * @param bitcode custom bitcode setting.\n */\nexport const withCustomBitcode: (applePlatform: 'ios' | 'macos') => ConfigPlugin<Bitcode> =\n  (applePlatform: 'ios' | 'macos') => (config, bitcode) => {\n    return withXcodeProject(applePlatform)(config, async (config) => {\n      config.modResults = await setBitcode(applePlatform)(bitcode, {\n        project: config.modResults,\n      });\n      return config;\n    });\n  };\n\n/**\n * Get the bitcode preference from the Expo config.\n */\nexport const getBitcode =\n  (applePlatform: 'ios' | 'macos') =>\n  (config: Pick<ExpoConfig, typeof applePlatform>): Bitcode =>\n    config[applePlatform]?.bitcode;\n\n/**\n * Enable or disable the `ENABLE_BITCODE` property of the project configurations.\n */\nexport const setBitcodeWithConfig =\n  (applePlatform: 'ios' | 'macos') =>\n  (\n    config: Pick<ExpoConfig, typeof applePlatform>,\n    { project }: { project: XcodeProject }\n  ): XcodeProject => {\n    const bitcode = getBitcode(applePlatform)(config);\n    return setBitcode(applePlatform)(bitcode, { project });\n  };\n\n/**\n * Enable or disable the `ENABLE_BITCODE` property.\n */\nexport const setBitcode =\n  (applePlatform: 'ios' | 'macos') =>\n  (bitcode: Bitcode, { project }: { project: XcodeProject }): XcodeProject => {\n    const isDefaultBehavior = bitcode == null;\n    // If the value is undefined, then do nothing.\n    if (isDefaultBehavior) {\n      return project;\n    }\n\n    const targetName = typeof bitcode === 'string' ? bitcode : undefined;\n    const isBitcodeEnabled = !!bitcode;\n    if (targetName) {\n      // Assert if missing\n      const configs = Object.entries(project.pbxXCBuildConfigurationSection()).filter(isNotComment);\n      const hasConfiguration = configs.find(\n        ([, configuration]) => configuration.name === targetName\n      );\n      if (hasConfiguration) {\n        // If targetName is defined then disable bitcode everywhere.\n        project.addBuildProperty('ENABLE_BITCODE', 'NO');\n      } else {\n        const names = [\n          // Remove duplicates, wrap in double quotes, and sort alphabetically.\n          ...new Set(configs.map(([, configuration]) => `\"${configuration.name}\"`)),\n        ].sort();\n        addWarningForPlatform(\n          applePlatform,\n          `${applePlatform}.bitcode`,\n          `No configuration named \"${targetName}\". Expected one of: ${names.join(', ')}.`\n        );\n      }\n    }\n\n    project.addBuildProperty('ENABLE_BITCODE', isBitcodeEnabled ? 'YES' : 'NO', targetName);\n\n    return project;\n  };\n"],"mappings":"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"}