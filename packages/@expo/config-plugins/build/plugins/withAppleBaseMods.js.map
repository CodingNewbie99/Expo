{"version":3,"file":"withAppleBaseMods.js","names":["_jsonFile","data","_interopRequireDefault","require","_plist","_assert","_fs","_interopRequireWildcard","_path","_xcode","_createBaseMod","_apple","_Entitlements","_Xcodeproj","_getInfoPlistPath","_modules","_sortObject","_warnings","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","readFile","writeFile","promises","getEntitlementsPlistTemplate","getInfoPlistTemplate","CFBundleDevelopmentRegion","CFBundleExecutable","CFBundleIdentifier","CFBundleName","CFBundlePackageType","CFBundleInfoDictionaryVersion","CFBundleSignature","LSRequiresIPhoneOS","NSAppTransportSecurity","NSAllowsArbitraryLoads","NSExceptionDomains","localhost","NSExceptionAllowsInsecureHTTPLoads","UILaunchStoryboardName","UIRequiredDeviceCapabilities","UIViewControllerBasedStatusBarAppearance","UIStatusBarStyle","CADisableMinimumFrameDurationOnPhone","defaultProviders","applePlatform","dangerous","provider","getFilePath","read","write","finalized","appDelegate","modRequest","projectRoot","Paths","getAppDelegateFilePath","filePath","getFileInfo","modResults","contents","expoPlist","isIntrospective","platformProjectRoot","projectName","supportingDirectory","path","join","resolve","introspect","plist","parse","error","build","sortObject","xcodeproj","getPBXProjectPath","project","xcode","parseSync","writeSync","infoPlist","config","getPbxproj","infoPlistBuildProperty","getInfoPlistPathFromPbxproj","infoPlistPath","fileExists","addWarningForPlatform","getInfoPlistPath","assert","entitlements","ensureApplicationTargetEntitlementsFileConfigured","Entitlements","getEntitlementsPath","ignoreExistingNativeFiles","fs","existsSync","podfile","getPodfilePath","podfileProperties","results","JsonFile","readAsync","writeAsync","withAppleBaseMods","providers","props","withGeneratedBaseMods","platform","getAppleModFileProviders","exports","lazyDefaultProvidersByPlatform","defaultProvidersForPlatform"],"sources":["../../src/plugins/withAppleBaseMods.ts"],"sourcesContent":["import JsonFile, { JSONObject, JSONValue } from '@expo/json-file';\nimport plist from '@expo/plist';\nimport assert from 'assert';\nimport fs, { promises } from 'fs';\nimport path from 'path';\nimport xcode, { XcodeProject } from 'xcode';\n\nimport { ForwardedBaseModOptions, provider, withGeneratedBaseMods } from './createBaseMod';\nimport type { ExportedConfig, ModConfig } from '../Plugin.types';\nimport { Entitlements, Paths } from '../apple';\nimport type { InfoPlist } from '../apple/AppleConfig.types';\nimport { ensureApplicationTargetEntitlementsFileConfigured } from '../apple/Entitlements';\nimport { getPbxproj } from '../apple/utils/Xcodeproj';\nimport { getInfoPlistPathFromPbxproj } from '../apple/utils/getInfoPlistPath';\nimport { fileExists } from '../utils/modules';\nimport { sortObject } from '../utils/sortObject';\nimport { addWarningForPlatform } from '../utils/warnings';\n\nconst { readFile, writeFile } = promises;\n\ntype AppleModName = keyof Required<ModConfig>['ios' | 'macos'];\n\nfunction getEntitlementsPlistTemplate() {\n  // TODO: Fetch the versioned template file if possible\n  return {};\n}\n\nfunction getInfoPlistTemplate() {\n  // TODO: Fetch the versioned template file if possible\n  return {\n    CFBundleDevelopmentRegion: '$(DEVELOPMENT_LANGUAGE)',\n    CFBundleExecutable: '$(EXECUTABLE_NAME)',\n    CFBundleIdentifier: '$(PRODUCT_BUNDLE_IDENTIFIER)',\n    CFBundleName: '$(PRODUCT_NAME)',\n    CFBundlePackageType: '$(PRODUCT_BUNDLE_PACKAGE_TYPE)',\n    CFBundleInfoDictionaryVersion: '6.0',\n    CFBundleSignature: '????',\n    LSRequiresIPhoneOS: true,\n    NSAppTransportSecurity: {\n      NSAllowsArbitraryLoads: true,\n      NSExceptionDomains: {\n        localhost: {\n          NSExceptionAllowsInsecureHTTPLoads: true,\n        },\n      },\n    },\n    UILaunchStoryboardName: 'SplashScreen',\n    UIRequiredDeviceCapabilities: ['armv7'],\n    UIViewControllerBasedStatusBarAppearance: false,\n    UIStatusBarStyle: 'UIStatusBarStyleDefault',\n    CADisableMinimumFrameDurationOnPhone: true,\n  };\n}\n\nconst defaultProviders = (applePlatform: 'ios' | 'macos') => ({\n  dangerous: provider<unknown>({\n    getFilePath() {\n      return '';\n    },\n    async read() {\n      return {};\n    },\n    async write() {},\n  }),\n  finalized: provider<unknown>({\n    getFilePath() {\n      return '';\n    },\n    async read() {\n      return {};\n    },\n    async write() {},\n  }),\n  // Append a rule to supply AppDelegate data to mods on `mods.ios.appDelegate`\n  appDelegate: provider<Paths.AppDelegateProjectFile>({\n    getFilePath({ modRequest: { projectRoot } }) {\n      // TODO: Get application AppDelegate file from pbxproj.\n      return Paths.getAppDelegateFilePath(applePlatform)(projectRoot);\n    },\n    async read(filePath) {\n      return Paths.getFileInfo(filePath);\n    },\n    async write(filePath: string, { modResults: { contents } }) {\n      await writeFile(filePath, contents);\n    },\n  }),\n  // Append a rule to supply Expo.plist data to mods on `mods.ios.expoPlist` or\n  // `mods.macos.expoPlist`\n  expoPlist: provider<JSONObject>({\n    isIntrospective: true,\n    getFilePath({ modRequest: { platformProjectRoot, projectName } }) {\n      const supportingDirectory = path.join(platformProjectRoot, projectName!, 'Supporting');\n      return path.resolve(supportingDirectory, 'Expo.plist');\n    },\n    async read(filePath, { modRequest: { introspect } }) {\n      try {\n        return plist.parse(await readFile(filePath, 'utf8'));\n      } catch (error) {\n        if (introspect) {\n          return {};\n        }\n        throw error;\n      }\n    },\n    async write(filePath, { modResults, modRequest: { introspect } }) {\n      if (introspect) {\n        return;\n      }\n      await writeFile(filePath, plist.build(sortObject(modResults)));\n    },\n  }),\n  // Append a rule to supply .xcodeproj data to mods on `mods.ios.xcodeproj` or\n  // `mods.macos.xcodeproj`\n  xcodeproj: provider<XcodeProject>({\n    getFilePath({ modRequest: { projectRoot } }) {\n      return Paths.getPBXProjectPath(applePlatform)(projectRoot);\n    },\n    async read(filePath) {\n      const project = xcode.project(filePath);\n      project.parseSync();\n      return project;\n    },\n    async write(filePath, { modResults }) {\n      await writeFile(filePath, modResults.writeSync());\n    },\n  }),\n  // Append a rule to supply Info.plist data to mods on `mods.ios.infoPlist` or\n  // `mods.macos.infoPlist`\n  infoPlist: provider<InfoPlist, ForwardedBaseModOptions>({\n    isIntrospective: true,\n    async getFilePath(config) {\n      let project: xcode.XcodeProject | null = null;\n      try {\n        project = getPbxproj(applePlatform)(config.modRequest.projectRoot);\n      } catch {\n        // noop\n      }\n\n      // Only check / warn if a project actually exists, this'll provide\n      // more accurate warning messages for users in managed projects.\n      if (project) {\n        const infoPlistBuildProperty = getInfoPlistPathFromPbxproj(applePlatform)(project);\n\n        if (infoPlistBuildProperty) {\n          //: [root]/myapp/[applePlatform]/MyApp/Info.plist\n          const infoPlistPath = path.join(\n            //: myapp/[applePlatform]\n            config.modRequest.platformProjectRoot,\n            //: MyApp/Info.plist\n            infoPlistBuildProperty\n          );\n          if (fileExists(infoPlistPath)) {\n            return infoPlistPath;\n          }\n          addWarningForPlatform(\n            applePlatform,\n            `mods.${applePlatform}.infoPlist`,\n            `Info.plist file linked to Xcode project does not exist: ${infoPlistPath}`\n          );\n        } else {\n          addWarningForPlatform(\n            applePlatform,\n            `mods.${applePlatform}.infoPlist`,\n            'Failed to find Info.plist linked to Xcode project.'\n          );\n        }\n      }\n      try {\n        // Fallback on glob...\n        return await Paths.getInfoPlistPath(applePlatform)(config.modRequest.projectRoot);\n      } catch (error: any) {\n        if (config.modRequest.introspect) {\n          // fallback to an empty string in introspection mode.\n          return '';\n        }\n        throw error;\n      }\n    },\n    async read(filePath, config) {\n      // Apply all of the Info.plist values to the `expo.ios.infoPlist` or\n      // `expo.macos.infoPlist` object\n\n      // TODO: Remove this in favor of just overwriting the Info.plist with the Expo object. This will enable people to actually remove values.\n      if (!config[applePlatform]) config[applePlatform] = {};\n      if (!config[applePlatform]!.infoPlist) config[applePlatform]!.infoPlist = {};\n\n      let modResults: InfoPlist;\n      try {\n        const contents = await readFile(filePath, 'utf8');\n        assert(contents, 'Info.plist is empty');\n        modResults = plist.parse(contents) as InfoPlist;\n      } catch (error: any) {\n        // Throw errors in introspection mode.\n        if (!config.modRequest.introspect) {\n          throw error;\n        }\n        // Fallback to using the infoPlist object from the Expo config.\n        modResults = getInfoPlistTemplate();\n      }\n\n      config[applePlatform]!.infoPlist = {\n        ...(modResults || {}),\n        ...config[applePlatform]!.infoPlist,\n      };\n\n      return config[applePlatform]!.infoPlist!;\n    },\n    async write(filePath, config) {\n      // Update the contents of the static infoPlist object\n      if (!config[applePlatform]) {\n        config[applePlatform] = {};\n      }\n      config[applePlatform]!.infoPlist = config.modResults;\n\n      // Return early without writing, in introspection mode.\n      if (config.modRequest.introspect) {\n        return;\n      }\n\n      await writeFile(filePath, plist.build(sortObject(config.modResults)));\n    },\n  }),\n  // Append a rule to supply .entitlements data to mods on\n  // `mods.ios.entitlements` or `mods.macos.entitlements`\n  entitlements: provider<JSONObject, ForwardedBaseModOptions>({\n    isIntrospective: true,\n\n    async getFilePath(config) {\n      try {\n        ensureApplicationTargetEntitlementsFileConfigured(applePlatform)(\n          config.modRequest.projectRoot\n        );\n        return Entitlements.getEntitlementsPath(applePlatform)(config.modRequest.projectRoot) ?? '';\n      } catch (error: any) {\n        if (config.modRequest.introspect) {\n          // fallback to an empty string in introspection mode.\n          return '';\n        }\n        throw error;\n      }\n    },\n\n    async read(filePath, config) {\n      let modResults: JSONObject;\n      try {\n        if (!config.modRequest.ignoreExistingNativeFiles && fs.existsSync(filePath)) {\n          const contents = await readFile(filePath, 'utf8');\n          assert(contents, 'Entitlements plist is empty');\n          modResults = plist.parse(contents);\n        } else {\n          modResults = getEntitlementsPlistTemplate();\n        }\n      } catch (error: any) {\n        // Throw errors in introspection mode.\n        if (!config.modRequest.introspect) {\n          throw error;\n        }\n        // Fallback to using the template file.\n        modResults = getEntitlementsPlistTemplate();\n      }\n\n      // Apply all of the .entitlements values to the `expo.ios.entitlements` or\n      // `expo.macos.entitlements` object\n      // TODO: Remove this in favor of just overwriting the .entitlements with the Expo object. This will enable people to actually remove values.\n      if (!config[applePlatform]) config[applePlatform] = {};\n      if (!config[applePlatform]!.entitlements) config[applePlatform]!.entitlements = {};\n\n      config[applePlatform]!.entitlements = {\n        ...(modResults || {}),\n        ...config[applePlatform]!.entitlements,\n      };\n\n      return config[applePlatform]!.entitlements!;\n    },\n\n    async write(filePath, config) {\n      // Update the contents of the static entitlements object\n      if (!config[applePlatform]) {\n        config[applePlatform] = {};\n      }\n      config[applePlatform]!.entitlements = config.modResults;\n\n      // Return early without writing, in introspection mode.\n      if (config.modRequest.introspect) {\n        return;\n      }\n\n      await writeFile(filePath, plist.build(sortObject(config.modResults)));\n    },\n  }),\n\n  podfile: provider<Paths.PodfileProjectFile>({\n    getFilePath({ modRequest: { projectRoot } }) {\n      return Paths.getPodfilePath(applePlatform)(projectRoot);\n    },\n    // @ts-expect-error\n    async read(filePath) {\n      // Note(cedric): this file is ruby, which is a 1-value subset of AppleLanguage and fails the type check\n      return Paths.getFileInfo(filePath);\n    },\n    async write(filePath, { modResults: { contents } }) {\n      await writeFile(filePath, contents);\n    },\n  }),\n\n  // Append a rule to supply Podfile.properties.json data to mods on\n  // `mods.ios.podfileProperties` or `mods.macos.podfileProperties`\n  podfileProperties: provider<Record<string, JSONValue>>({\n    isIntrospective: true,\n\n    getFilePath({ modRequest: { platformProjectRoot } }) {\n      return path.resolve(platformProjectRoot, 'Podfile.properties.json');\n    },\n    async read(filePath) {\n      let results: Record<string, JSONValue> = {};\n      try {\n        results = await JsonFile.readAsync(filePath);\n      } catch {}\n      return results;\n    },\n    async write(filePath, { modResults, modRequest: { introspect } }) {\n      if (introspect) {\n        return;\n      }\n      await JsonFile.writeAsync(filePath, modResults);\n    },\n  }),\n});\n\ntype AppleDefaultProviders = ReturnType<typeof defaultProviders>;\n\nexport const withAppleBaseMods =\n  (applePlatform: 'ios' | 'macos') =>\n  (\n    config: ExportedConfig,\n    {\n      providers,\n      ...props\n    }: ForwardedBaseModOptions & { providers?: Partial<AppleDefaultProviders> } = {}\n  ): ExportedConfig => {\n    return withGeneratedBaseMods<AppleModName>(config, {\n      ...props,\n      platform: applePlatform,\n      providers: providers ?? getAppleModFileProviders(applePlatform),\n    });\n  };\n\n/**\n * A lazy-initialized record of defaultProviders values by platform. Allows us\n * to return the same defaultProviders value for the platform each time.\n */\nconst lazyDefaultProvidersByPlatform = {} as Partial<\n  Record<'ios' | 'macos', AppleDefaultProviders>\n>;\nexport const getAppleModFileProviders = (applePlatform: 'ios' | 'macos') => {\n  // Lazy-initialize (and thereafter reuse) the defaultProviders value for each\n  // applePlatform.\n  let defaultProvidersForPlatform = lazyDefaultProvidersByPlatform[applePlatform];\n  if (!defaultProvidersForPlatform) {\n    defaultProvidersForPlatform = defaultProviders(applePlatform);\n    lazyDefaultProvidersByPlatform[applePlatform] = defaultProvidersForPlatform;\n  }\n  return defaultProvidersForPlatform;\n};\n"],"mappings":"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"}