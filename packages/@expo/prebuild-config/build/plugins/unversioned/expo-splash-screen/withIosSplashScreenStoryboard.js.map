{"version":3,"sources":["../../../../src/plugins/unversioned/expo-splash-screen/withIosSplashScreenStoryboard.ts"],"names":["STORYBOARD_FILE_PATH","STORYBOARD_MOD_NAME","withIosSplashScreenStoryboard","config","action","platform","mod","withIosSplashScreenStoryboardBaseMod","BaseMods","withGeneratedBaseMods","saveToInternal","skipEmptyMod","providers","provider","isIntrospective","getFilePath","modRequest","path","join","platformProjectRoot","projectName","read","filePath","contents","fs","promises","readFile","xml","Parser","parseStringPromise","error","getTemplateAsync","write","modResults","introspect","writeFile"],"mappings":";;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;AAEO,MAAMA,oBAAoB,GAAG,2BAA7B;;AAEP,MAAMC,mBAAmB,GAAG,wBAA5B;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMC,6BAAwE,GAAG,CACtFC,MADsF,EAEtFC,MAFsF,KAGnF;AACH,SAAO,8BAAQD,MAAR,EAAgB;AACrBE,IAAAA,QAAQ,EAAE,KADW;AAErBC,IAAAA,GAAG,EAAEL,mBAFgB;AAGrBG,IAAAA;AAHqB,GAAhB,CAAP;AAKD,CATM;AAWP;;;;;AACO,MAAMG,oCAAkD,GAAGJ,MAAM,IAAI;AAC1E,SAAOK,0BAASC,qBAAT,CAA+BN,MAA/B,EAAuC;AAC5CE,IAAAA,QAAQ,EAAE,KADkC;AAE5CK,IAAAA,cAAc,EAAE,IAF4B;AAG5CC,IAAAA,YAAY,EAAE,KAH8B;AAI5CC,IAAAA,SAAS,EAAE;AACT;AACA,OAACX,mBAAD,GAAuBO,0BAASK,QAAT,CAA0C;AAC/DC,QAAAA,eAAe,EAAE,IAD8C;;AAE/D,cAAMC,WAAN,CAAkB;AAAEC,UAAAA;AAAF,SAAlB,EAAkC;AAChC;AACA,iBAAOC,IAAI,GAACC,IAAL,EACL;AACAF,UAAAA,UAAU,CAACG,mBAFN,EAGL;AACAH,UAAAA,UAAU,CAACI,WAJN,EAKL;AACApB,UAAAA,oBANK,CAAP;AAQD,SAZ8D;;AAa/D,cAAMqB,IAAN,CAAWC,QAAX,EAAqB;AACnB,cAAI;AACF,kBAAMC,QAAQ,GAAG,MAAMC,EAAE,GAACC,QAAH,CAAYC,QAAZ,CAAqBJ,QAArB,EAA+B,MAA/B,CAAvB;AACA,kBAAMK,GAAG,GAAG,MAAM,KAAIC,gBAAJ,IAAaC,kBAAb,CAAgCN,QAAhC,CAAlB;AACA,mBAAOI,GAAP;AACD,WAJD,CAIE,OAAOG,KAAP,EAAc;AACd,mBAAOC,gBAAgB,EAAvB;AACD;AACF,SArB8D;;AAsB/D,cAAMC,KAAN,CAAYV,QAAZ,EAAsB;AAAEW,UAAAA,UAAF;AAAcjB,UAAAA,UAAU,EAAE;AAAEkB,YAAAA;AAAF;AAA1B,SAAtB,EAAkE;AAChE,cAAIA,UAAJ,EAAgB;AACd;AACD;;AACD,gBAAMV,EAAE,GAACC,QAAH,CAAYU,SAAZ,CAAsBb,QAAtB,EAAgC,kCAASW,UAAT,CAAhC,CAAN;AACD;;AA3B8D,OAA1C;AAFd;AAJiC,GAAvC,CAAP;AAqCD,CAtCM;AAwCP;;;;;AACO,eAAeF,gBAAf,GAAmE;AACxE,QAAMR,QAAQ,GAAI;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAtEE;AAuEA,SAAO,MAAM,KAAIK,gBAAJ,IAAaC,kBAAb,CAAgCN,QAAhC,CAAb;AACD","sourcesContent":["import { BaseMods, ConfigPlugin, Mod, withMod } from '@expo/config-plugins';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { Parser } from 'xml2js';\n\nimport { IBSplashScreenDocument, toString } from './InterfaceBuilder';\n\nexport const STORYBOARD_FILE_PATH = './SplashScreen.storyboard';\n\nconst STORYBOARD_MOD_NAME = 'splashScreenStoryboard';\n\n/**\n * Provides the SplashScreen `.storyboard` xml data for modification.\n *\n * @param config\n * @param action\n */\nexport const withIosSplashScreenStoryboard: ConfigPlugin<Mod<IBSplashScreenDocument>> = (\n  config,\n  action\n) => {\n  return withMod(config, {\n    platform: 'ios',\n    mod: STORYBOARD_MOD_NAME,\n    action,\n  });\n};\n\n/** Append a custom rule to supply SplashScreen `.storyboard` xml data to mods on `mods.ios.splashScreenStoryboard` */\nexport const withIosSplashScreenStoryboardBaseMod: ConfigPlugin = config => {\n  return BaseMods.withGeneratedBaseMods(config, {\n    platform: 'ios',\n    saveToInternal: true,\n    skipEmptyMod: false,\n    providers: {\n      // Append a custom rule to supply .storyboard xml data to mods on `mods.ios.splashScreenStoryboard`\n      [STORYBOARD_MOD_NAME]: BaseMods.provider<IBSplashScreenDocument>({\n        isIntrospective: true,\n        async getFilePath({ modRequest }) {\n          //: [root]/myapp/ios/MyApp/SplashScreen.storyboard\n          return path.join(\n            //: myapp/ios\n            modRequest.platformProjectRoot,\n            // ./MyApp\n            modRequest.projectName!,\n            // ./SplashScreen.storyboard\n            STORYBOARD_FILE_PATH\n          );\n        },\n        async read(filePath) {\n          try {\n            const contents = await fs.promises.readFile(filePath, 'utf8');\n            const xml = await new Parser().parseStringPromise(contents);\n            return xml;\n          } catch (error) {\n            return getTemplateAsync();\n          }\n        },\n        async write(filePath, { modResults, modRequest: { introspect } }) {\n          if (introspect) {\n            return;\n          }\n          await fs.promises.writeFile(filePath, toString(modResults));\n        },\n      }),\n    },\n  });\n};\n\n/** Get a template splash screen storyboard file. */\nexport async function getTemplateAsync(): Promise<IBSplashScreenDocument> {\n  const contents = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <document\n      type=\"com.apple.InterfaceBuilder3.CocoaTouch.Storyboard.XIB\"\n      version=\"3.0\"\n      toolsVersion=\"16096\"\n      targetRuntime=\"iOS.CocoaTouch\"\n      propertyAccessControl=\"none\"\n      useAutolayout=\"YES\"\n      launchScreen=\"YES\"\n      useTraitCollections=\"YES\"\n      useSafeAreas=\"YES\"\n      colorMatched=\"YES\"\n      initialViewController=\"EXPO-VIEWCONTROLLER-1\"\n    >\n      <dependencies>\n        <deployment identifier=\"iOS\"/>\n        <plugIn identifier=\"com.apple.InterfaceBuilder.IBCocoaTouchPlugin\" version=\"16087\"/>\n        <capability name=\"Safe area layout guides\" minToolsVersion=\"9.0\"/>\n        <capability name=\"documents saved in the Xcode 8 format\" minToolsVersion=\"8.0\"/>\n      </dependencies>\n      <scenes>\n        <scene sceneID=\"EXPO-SCENE-1\">\n          <objects>\n            <viewController\n              storyboardIdentifier=\"SplashScreenViewController\"\n              id=\"EXPO-VIEWCONTROLLER-1\"\n              sceneMemberID=\"viewController\"\n            >\n              <view\n                key=\"view\"\n                userInteractionEnabled=\"NO\"\n                contentMode=\"scaleToFill\"\n                insetsLayoutMarginsFromSafeArea=\"NO\"\n                id=\"EXPO-ContainerView\"\n                userLabel=\"ContainerView\"\n              >\n                <rect key=\"frame\" x=\"0.0\" y=\"0.0\" width=\"414\" height=\"736\"/>\n                <autoresizingMask key=\"autoresizingMask\" flexibleMaxX=\"YES\" flexibleMaxY=\"YES\"/>\n                <subviews>\n                  <imageView\n                    userInteractionEnabled=\"NO\"\n                    contentMode=\"scaleAspectFill\"\n                    horizontalHuggingPriority=\"251\"\n                    verticalHuggingPriority=\"251\"\n                    insetsLayoutMarginsFromSafeArea=\"NO\"\n                    image=\"SplashScreenBackground\"\n                    translatesAutoresizingMaskIntoConstraints=\"NO\"\n                    id=\"EXPO-SplashScreenBackground\"\n                    userLabel=\"SplashScreenBackground\"\n                  >\n                    <rect key=\"frame\" x=\"0.0\" y=\"0.0\" width=\"414\" height=\"736\"/>\n                  </imageView>\n                </subviews>\n                <color key=\"backgroundColor\" systemColor=\"systemBackgroundColor\"/>\n                <constraints>\n                  <constraint firstItem=\"EXPO-SplashScreenBackground\" firstAttribute=\"top\" secondItem=\"EXPO-ContainerView\" secondAttribute=\"top\" id=\"1gX-mQ-vu6\"/>\n                  <constraint firstItem=\"EXPO-SplashScreenBackground\" firstAttribute=\"leading\" secondItem=\"EXPO-ContainerView\" secondAttribute=\"leading\" id=\"6tX-OG-Sck\"/>\n                  <constraint firstItem=\"EXPO-SplashScreenBackground\" firstAttribute=\"trailing\" secondItem=\"EXPO-ContainerView\" secondAttribute=\"trailing\" id=\"ABX-8g-7v4\"/>\n                  <constraint firstItem=\"EXPO-SplashScreenBackground\" firstAttribute=\"bottom\" secondItem=\"EXPO-ContainerView\" secondAttribute=\"bottom\" id=\"jkI-2V-eW5\"/>\n                </constraints>\n                <viewLayoutGuide key=\"safeArea\" id=\"EXPO-SafeArea\"/>\n              </view>\n            </viewController>\n            <placeholder placeholderIdentifier=\"IBFirstResponder\" id=\"EXPO-PLACEHOLDER-1\" userLabel=\"First Responder\" sceneMemberID=\"firstResponder\"/>\n          </objects>\n        </scene>\n      </scenes>\n      <resources>\n        <image name=\"SplashScreenBackground\" width=\"1\" height=\"1\"/>\n      </resources>\n    </document>`;\n  return await new Parser().parseStringPromise(contents);\n}\n"],"file":"withIosSplashScreenStoryboard.js"}