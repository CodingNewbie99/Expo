{"version":3,"file":"withIosRootViewBackgroundColor.js","names":["_configPlugins","data","require","_semver","_interopRequireDefault","obj","__esModule","default","BACKGROUND_COLOR_KEY","debug","withIosRootViewBackgroundColor","config","withInfoPlist","shouldUseLegacyBehavior","modResults","setRootViewBackgroundColor","modRequest","projectRoot","warnSystemUIMissing","exports","sdkVersion","semver","lt","backgroundColor","getRootViewBackgroundColor","WarningAggregator","addWarningIOS","infoPlist","color","convertColor","ios"],"sources":["../../../../src/plugins/unversioned/expo-system-ui/withIosRootViewBackgroundColor.ts"],"sourcesContent":["import {\n  ConfigPlugin,\n  InfoPlist,\n  WarningAggregator,\n  convertColor,\n  withInfoPlist,\n} from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\nimport semver from 'semver';\n\n// Maps to the template AppDelegate.m\nconst BACKGROUND_COLOR_KEY = 'RCTRootViewBackgroundColor';\n\nconst debug = require('debug')('expo:system-ui:plugin:ios');\n\nexport const withIosRootViewBackgroundColor: ConfigPlugin = (config) => {\n  config = withInfoPlist(config, (config) => {\n    if (shouldUseLegacyBehavior(config)) {\n      config.modResults = setRootViewBackgroundColor(\n        config.modRequest.projectRoot,\n        config,\n        config.modResults\n      );\n    } else {\n      warnSystemUIMissing(config);\n    }\n    return config;\n  });\n  return config;\n};\n\n/** The template was changed in SDK 43 to move the background color logic to the `expo-system-ui` module */\nexport function shouldUseLegacyBehavior(config: Pick<ExpoConfig, 'sdkVersion'>): boolean {\n  try {\n    return !!(config.sdkVersion && semver.lt(config.sdkVersion, '44.0.0'));\n  } catch {}\n  return false;\n}\n\nexport function warnSystemUIMissing(\n  config: Pick<ExpoConfig, 'sdkVersion' | 'backgroundColor' | 'ios'>\n) {\n  const backgroundColor = getRootViewBackgroundColor(config);\n\n  if (backgroundColor) {\n    // Background color needs to be set programmatically\n    WarningAggregator.addWarningIOS(\n      'ios.backgroundColor',\n      'Install expo-system-ui to enable this feature',\n      'https://docs.expo.dev/build-reference/migrating/#expo-config--backgroundcolor--depends-on'\n    );\n  }\n}\n\nexport function setRootViewBackgroundColor(\n  projectRoot: string,\n  config: Pick<ExpoConfig, 'backgroundColor' | 'ios'>,\n  infoPlist: InfoPlist\n): InfoPlist {\n  const backgroundColor = getRootViewBackgroundColor(config);\n  if (!backgroundColor) {\n    delete infoPlist[BACKGROUND_COLOR_KEY];\n  } else {\n    const color = convertColor(projectRoot, backgroundColor);\n    infoPlist[BACKGROUND_COLOR_KEY] = color;\n\n    debug(`Convert color: ${backgroundColor} -> ${color}`);\n  }\n  return infoPlist;\n}\n\nexport function getRootViewBackgroundColor(config: Pick<ExpoConfig, 'ios' | 'backgroundColor'>) {\n  return config.ios?.backgroundColor || config.backgroundColor || null;\n}\n"],"mappings":";;;;;;;;;;AAAA,SAAAA,eAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,cAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAQA,SAAAE,QAAA;EAAA,MAAAF,IAAA,GAAAG,sBAAA,CAAAF,OAAA;EAAAC,OAAA,YAAAA,CAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAA4B,SAAAG,uBAAAC,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAE5B;AACA,MAAMG,oBAAoB,GAAG,4BAA4B;AAEzD,MAAMC,KAAK,GAAGP,OAAO,CAAC,OAAO,CAAC,CAAC,2BAA2B,CAAC;AAEpD,MAAMQ,8BAA4C,GAAIC,MAAM,IAAK;EACtEA,MAAM,GAAG,IAAAC,8BAAa,EAACD,MAAM,EAAGA,MAAM,IAAK;IACzC,IAAIE,uBAAuB,CAACF,MAAM,CAAC,EAAE;MACnCA,MAAM,CAACG,UAAU,GAAGC,0BAA0B,CAC5CJ,MAAM,CAACK,UAAU,CAACC,WAAW,EAC7BN,MAAM,EACNA,MAAM,CAACG,UACT,CAAC;IACH,CAAC,MAAM;MACLI,mBAAmB,CAACP,MAAM,CAAC;IAC7B;IACA,OAAOA,MAAM;EACf,CAAC,CAAC;EACF,OAAOA,MAAM;AACf,CAAC;;AAED;AAAAQ,OAAA,CAAAT,8BAAA,GAAAA,8BAAA;AACO,SAASG,uBAAuBA,CAACF,MAAsC,EAAW;EACvF,IAAI;IACF,OAAO,CAAC,EAAEA,MAAM,CAACS,UAAU,IAAIC,iBAAM,CAACC,EAAE,CAACX,MAAM,CAACS,UAAU,EAAE,QAAQ,CAAC,CAAC;EACxE,CAAC,CAAC,MAAM,CAAC;EACT,OAAO,KAAK;AACd;AAEO,SAASF,mBAAmBA,CACjCP,MAAkE,EAClE;EACA,MAAMY,eAAe,GAAGC,0BAA0B,CAACb,MAAM,CAAC;EAE1D,IAAIY,eAAe,EAAE;IACnB;IACAE,kCAAiB,CAACC,aAAa,CAC7B,qBAAqB,EACrB,+CAA+C,EAC/C,2FACF,CAAC;EACH;AACF;AAEO,SAASX,0BAA0BA,CACxCE,WAAmB,EACnBN,MAAmD,EACnDgB,SAAoB,EACT;EACX,MAAMJ,eAAe,GAAGC,0BAA0B,CAACb,MAAM,CAAC;EAC1D,IAAI,CAACY,eAAe,EAAE;IACpB,OAAOI,SAAS,CAACnB,oBAAoB,CAAC;EACxC,CAAC,MAAM;IACL,MAAMoB,KAAK,GAAG,IAAAC,6BAAY,EAACZ,WAAW,EAAEM,eAAe,CAAC;IACxDI,SAAS,CAACnB,oBAAoB,CAAC,GAAGoB,KAAK;IAEvCnB,KAAK,CAAE,kBAAiBc,eAAgB,OAAMK,KAAM,EAAC,CAAC;EACxD;EACA,OAAOD,SAAS;AAClB;AAEO,SAASH,0BAA0BA,CAACb,MAAmD,EAAE;EAC9F,OAAOA,MAAM,CAACmB,GAAG,EAAEP,eAAe,IAAIZ,MAAM,CAACY,eAAe,IAAI,IAAI;AACtE"}