{"version":3,"file":"withIosFacebook.js","names":["appendScheme","IOSConfig","Scheme","fbSchemes","withIosFacebook","config","withInfoPlist","modResults","setFacebookConfig","getFacebookScheme","facebookScheme","getFacebookAppId","facebookAppId","getFacebookDisplayName","facebookDisplayName","getFacebookAutoInitEnabled","facebookAutoInitEnabled","getFacebookAutoLogAppEvents","facebookAutoLogAppEventsEnabled","getFacebookAdvertiserIDCollection","facebookAdvertiserIDCollectionEnabled","infoPlist","setFacebookAppId","setFacebookApplicationQuerySchemes","setFacebookDisplayName","setFacebookAutoInitEnabled","setFacebookAutoLogAppEventsEnabled","setFacebookAdvertiserIDCollectionEnabled","setFacebookScheme","FacebookAutoInitEnabled","FacebookAutoLogAppEventsEnabled","FacebookAdvertiserIDCollectionEnabled","FacebookAppID","FacebookDisplayName","existingSchemes","LSApplicationQueriesSchemes","includes","length","restInfoPlist","scheme","index","findIndex","s","splice","updatedSchemes"],"sources":["../../../../src/plugins/unversioned/expo-facebook/withIosFacebook.ts"],"sourcesContent":["import { ConfigPlugin, InfoPlist, IOSConfig, withInfoPlist } from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\n\nconst { appendScheme } = IOSConfig.Scheme;\n\ntype ExpoConfigFacebook = Pick<\n  ExpoConfig,\n  | 'facebookScheme'\n  | 'facebookAdvertiserIDCollectionEnabled'\n  | 'facebookAppId'\n  | 'facebookAutoInitEnabled'\n  | 'facebookAutoLogAppEventsEnabled'\n  | 'facebookDisplayName'\n>;\n\nconst fbSchemes = ['fbapi', 'fb-messenger-api', 'fbauth2', 'fbshareextension'];\n\nexport const withIosFacebook: ConfigPlugin = (config) => {\n  return withInfoPlist(config, (config) => {\n    config.modResults = setFacebookConfig(config, config.modResults);\n    return config;\n  });\n};\n\n/**\n * Getters\n * TODO: these getters are the same between ios/android, we could reuse them\n */\n\nexport function getFacebookScheme(config: ExpoConfigFacebook) {\n  return config.facebookScheme ?? null;\n}\n\nexport function getFacebookAppId(config: Pick<ExpoConfigFacebook, 'facebookAppId'>) {\n  return config.facebookAppId ?? null;\n}\n\nexport function getFacebookDisplayName(config: ExpoConfigFacebook) {\n  return config.facebookDisplayName ?? null;\n}\n\nexport function getFacebookAutoInitEnabled(config: ExpoConfigFacebook) {\n  return config.facebookAutoInitEnabled ?? null;\n}\n\nexport function getFacebookAutoLogAppEvents(config: ExpoConfigFacebook) {\n  return config.facebookAutoLogAppEventsEnabled ?? null;\n}\n\nexport function getFacebookAdvertiserIDCollection(config: ExpoConfigFacebook) {\n  return config.facebookAdvertiserIDCollectionEnabled ?? null;\n}\n\n/**\n * Setters\n */\n\nexport function setFacebookConfig(config: ExpoConfigFacebook, infoPlist: InfoPlist) {\n  infoPlist = setFacebookAppId(config, infoPlist);\n  infoPlist = setFacebookApplicationQuerySchemes(config, infoPlist);\n  infoPlist = setFacebookDisplayName(config, infoPlist);\n  infoPlist = setFacebookAutoInitEnabled(config, infoPlist);\n  infoPlist = setFacebookAutoLogAppEventsEnabled(config, infoPlist);\n  infoPlist = setFacebookAdvertiserIDCollectionEnabled(config, infoPlist);\n  infoPlist = setFacebookScheme(config, infoPlist);\n  return infoPlist;\n}\n\nexport function setFacebookScheme(config: ExpoConfigFacebook, infoPlist: InfoPlist) {\n  const facebookScheme = getFacebookScheme(config);\n  return appendScheme(facebookScheme, infoPlist);\n}\n\nexport function setFacebookAutoInitEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAutoInitEnabled, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAutoInitEnabled = getFacebookAutoInitEnabled(config);\n\n  if (facebookAutoInitEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAutoInitEnabled: facebookAutoInitEnabled,\n  };\n}\n\nexport function setFacebookAutoLogAppEventsEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAutoLogAppEventsEnabled, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAutoLogAppEventsEnabled = getFacebookAutoLogAppEvents(config);\n\n  if (facebookAutoLogAppEventsEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAutoLogAppEventsEnabled: facebookAutoLogAppEventsEnabled,\n  };\n}\n\nexport function setFacebookAdvertiserIDCollectionEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAdvertiserIDCollectionEnabled, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAdvertiserIDCollectionEnabled = getFacebookAdvertiserIDCollection(config);\n\n  if (facebookAdvertiserIDCollectionEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAdvertiserIDCollectionEnabled: facebookAdvertiserIDCollectionEnabled,\n  };\n}\n\nexport function setFacebookAppId(\n  config: Pick<ExpoConfigFacebook, 'facebookAppId'>,\n  { FacebookAppID, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookAppId = getFacebookAppId(config);\n  if (facebookAppId) {\n    return {\n      ...infoPlist,\n      FacebookAppID: facebookAppId,\n    };\n  }\n\n  return infoPlist;\n}\n\nexport function setFacebookDisplayName(\n  config: ExpoConfigFacebook,\n  { FacebookDisplayName, ...infoPlist }: InfoPlist\n): InfoPlist {\n  const facebookDisplayName = getFacebookDisplayName(config);\n\n  if (facebookDisplayName) {\n    return {\n      ...infoPlist,\n      FacebookDisplayName: facebookDisplayName,\n    };\n  }\n\n  return infoPlist;\n}\n\nexport function setFacebookApplicationQuerySchemes(\n  config: Pick<ExpoConfigFacebook, 'facebookAppId'>,\n  infoPlist: InfoPlist\n): InfoPlist {\n  const facebookAppId = getFacebookAppId(config);\n\n  const existingSchemes = infoPlist.LSApplicationQueriesSchemes || [];\n\n  if (facebookAppId && existingSchemes.includes('fbapi')) {\n    // already included, no need to add again\n    return infoPlist;\n  } else if (!facebookAppId && !existingSchemes.length) {\n    // already removed, no need to strip again\n    const { LSApplicationQueriesSchemes, ...restInfoPlist } = infoPlist;\n    if (LSApplicationQueriesSchemes?.length) {\n      return infoPlist;\n    } else {\n      // Return without the empty LSApplicationQueriesSchemes array.\n      return restInfoPlist;\n    }\n  }\n\n  // Remove all schemes\n  for (const scheme of fbSchemes) {\n    const index = existingSchemes.findIndex((s) => s === scheme);\n    if (index > -1) {\n      existingSchemes.splice(index, 1);\n    }\n  }\n\n  if (!facebookAppId) {\n    // Run again to ensure the LSApplicationQueriesSchemes array is stripped if needed.\n    infoPlist.LSApplicationQueriesSchemes = existingSchemes;\n    if (!infoPlist.LSApplicationQueriesSchemes.length) {\n      delete infoPlist.LSApplicationQueriesSchemes;\n    }\n    return infoPlist;\n  }\n\n  // TODO: it's actually necessary to add more query schemes (specific to the\n  // app) to support all of the features that the Facebook SDK provides, should\n  // we sync those here too?\n  const updatedSchemes = [...existingSchemes, ...fbSchemes];\n\n  return {\n    ...infoPlist,\n    LSApplicationQueriesSchemes: updatedSchemes,\n  };\n}\n"],"mappings":"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"}