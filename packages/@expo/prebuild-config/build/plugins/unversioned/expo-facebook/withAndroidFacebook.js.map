{"version":3,"file":"withAndroidFacebook.js","names":["buildResourceItem","AndroidConfig","Resources","removeStringItem","setStringItem","Strings","addMetaDataItemToMainApplication","getMainApplicationOrThrow","prefixAndroidKeys","removeMetaDataItemFromMainApplication","Manifest","CUSTOM_TAB_ACTIVITY","STRING_FACEBOOK_APP_ID","META_APP_ID","META_APP_NAME","META_AUTO_INIT","META_AUTO_LOG_APP_EVENTS","META_AD_ID_COLLECTION","withFacebookAppIdString","config","withStringsXml","modResults","applyFacebookAppIdString","withFacebookManifest","withAndroidManifest","setFacebookConfig","buildXMLItem","head","children","$","buildAndroidItem","datum","item","name","getFacebookSchemeActivity","scheme","exported","action","category","data","getFacebookScheme","facebookScheme","getFacebookAppId","facebookAppId","getFacebookDisplayName","facebookDisplayName","getFacebookAutoInitEnabled","facebookAutoInitEnabled","getFacebookAutoLogAppEvents","facebookAutoLogAppEventsEnabled","getFacebookAdvertiserIDCollection","facebookAdvertiserIDCollectionEnabled","ensureFacebookActivity","mainApplication","Array","isArray","activity","filter","push","stringsJSON","appId","value","androidManifest","displayName","autoInitEnabled","autoLogAppEvents","advertiserIdCollection"],"sources":["../../../../src/plugins/unversioned/expo-facebook/withAndroidFacebook.ts"],"sourcesContent":["import {\n  AndroidConfig,\n  ConfigPlugin,\n  withAndroidManifest,\n  withStringsXml,\n} from '@expo/config-plugins';\nimport { ExpoConfig } from '@expo/config-types';\n\nconst { buildResourceItem } = AndroidConfig.Resources;\nconst { removeStringItem, setStringItem } = AndroidConfig.Strings;\nconst {\n  addMetaDataItemToMainApplication,\n  getMainApplicationOrThrow,\n  prefixAndroidKeys,\n  removeMetaDataItemFromMainApplication,\n} = AndroidConfig.Manifest;\n\nconst CUSTOM_TAB_ACTIVITY = 'com.facebook.CustomTabActivity';\nconst STRING_FACEBOOK_APP_ID = 'facebook_app_id';\nconst META_APP_ID = 'com.facebook.sdk.ApplicationId';\nconst META_APP_NAME = 'com.facebook.sdk.ApplicationName';\nconst META_AUTO_INIT = 'com.facebook.sdk.AutoInitEnabled';\nconst META_AUTO_LOG_APP_EVENTS = 'com.facebook.sdk.AutoLogAppEventsEnabled';\nconst META_AD_ID_COLLECTION = 'com.facebook.sdk.AdvertiserIDCollectionEnabled';\n\nexport const withFacebookAppIdString: ConfigPlugin = (config) => {\n  return withStringsXml(config, (config) => {\n    config.modResults = applyFacebookAppIdString(config, config.modResults);\n    return config;\n  });\n};\n\nexport const withFacebookManifest: ConfigPlugin = (config) => {\n  return withAndroidManifest(config, (config) => {\n    config.modResults = setFacebookConfig(config, config.modResults);\n    return config;\n  });\n};\n\nfunction buildXMLItem({\n  head,\n  children,\n}: {\n  head: Record<string, string>;\n  children?: Record<string, string | any[]>;\n}) {\n  return { ...(children ?? {}), $: head };\n}\n\nfunction buildAndroidItem(datum: string | Record<string, any>) {\n  const item = typeof datum === 'string' ? { name: datum } : datum;\n  const head = prefixAndroidKeys(item);\n  return buildXMLItem({ head });\n}\n\nfunction getFacebookSchemeActivity(scheme: string) {\n  /**\n   <activity\n      android:name=\"com.facebook.CustomTabActivity\"\n      android:exported=\"true\">\n      <intent-filter>\n          <action android:name=\"android.intent.action.VIEW\" />\n          <category android:name=\"android.intent.category.DEFAULT\" />\n          <category android:name=\"android.intent.category.BROWSABLE\" />\n          <data android:scheme=\"${scheme}\" />\n      </intent-filter>\n  </activity>\n     */\n  return buildXMLItem({\n    head: prefixAndroidKeys({\n      name: CUSTOM_TAB_ACTIVITY,\n      exported: 'true',\n    }),\n    children: {\n      'intent-filter': [\n        {\n          action: [buildAndroidItem('android.intent.action.VIEW')],\n          category: [\n            buildAndroidItem('android.intent.category.DEFAULT'),\n            buildAndroidItem('android.intent.category.BROWSABLE'),\n          ],\n          data: [buildAndroidItem({ scheme })],\n        },\n      ],\n    },\n  }) as AndroidConfig.Manifest.ManifestActivity;\n}\n\ntype ExpoConfigFacebook = Pick<\n  ExpoConfig,\n  | 'facebookScheme'\n  | 'facebookAdvertiserIDCollectionEnabled'\n  | 'facebookAppId'\n  | 'facebookAutoInitEnabled'\n  | 'facebookAutoLogAppEventsEnabled'\n  | 'facebookDisplayName'\n>;\n\nexport function getFacebookScheme(config: ExpoConfigFacebook) {\n  return config.facebookScheme ?? null;\n}\n\nexport function getFacebookAppId(config: ExpoConfigFacebook) {\n  return config.facebookAppId ?? null;\n}\n\nexport function getFacebookDisplayName(config: ExpoConfigFacebook) {\n  return config.facebookDisplayName ?? null;\n}\nexport function getFacebookAutoInitEnabled(config: ExpoConfigFacebook) {\n  return config.facebookAutoInitEnabled ?? null;\n}\n\nexport function getFacebookAutoLogAppEvents(config: ExpoConfigFacebook) {\n  return config.facebookAutoLogAppEventsEnabled ?? null;\n}\n\nexport function getFacebookAdvertiserIDCollection(config: ExpoConfigFacebook) {\n  return config.facebookAdvertiserIDCollectionEnabled ?? null;\n}\n\nfunction ensureFacebookActivity({\n  mainApplication,\n  scheme,\n}: {\n  mainApplication: AndroidConfig.Manifest.ManifestApplication;\n  scheme: string | null;\n}) {\n  if (Array.isArray(mainApplication.activity)) {\n    // Remove all Facebook CustomTabActivities first\n    mainApplication.activity = mainApplication.activity.filter((activity) => {\n      return activity.$?.['android:name'] !== CUSTOM_TAB_ACTIVITY;\n    });\n  } else {\n    mainApplication.activity = [];\n  }\n\n  // If a new scheme is defined, append it to the activity.\n  if (scheme) {\n    mainApplication.activity.push(getFacebookSchemeActivity(scheme));\n  }\n  return mainApplication;\n}\n\nfunction applyFacebookAppIdString(\n  config: ExpoConfigFacebook,\n  stringsJSON: AndroidConfig.Resources.ResourceXML\n) {\n  const appId = getFacebookAppId(config);\n\n  if (appId) {\n    return setStringItem(\n      [buildResourceItem({ name: STRING_FACEBOOK_APP_ID, value: appId })],\n      stringsJSON\n    );\n  }\n  return removeStringItem(STRING_FACEBOOK_APP_ID, stringsJSON);\n}\n\nexport function setFacebookConfig(\n  config: ExpoConfigFacebook,\n  androidManifest: AndroidConfig.Manifest.AndroidManifest\n) {\n  const scheme = getFacebookScheme(config);\n\n  const appId = getFacebookAppId(config);\n  const displayName = getFacebookDisplayName(config);\n  const autoInitEnabled = getFacebookAutoInitEnabled(config);\n  const autoLogAppEvents = getFacebookAutoLogAppEvents(config);\n  const advertiserIdCollection = getFacebookAdvertiserIDCollection(config);\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  let mainApplication = getMainApplicationOrThrow(androidManifest);\n\n  mainApplication = ensureFacebookActivity({ scheme, mainApplication });\n\n  if (appId) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_APP_ID,\n      `@string/${STRING_FACEBOOK_APP_ID}`\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_APP_ID);\n  }\n  if (displayName) {\n    mainApplication = addMetaDataItemToMainApplication(mainApplication, META_APP_NAME, displayName);\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_APP_NAME);\n  }\n  if (autoInitEnabled !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AUTO_INIT,\n      autoInitEnabled ? 'true' : 'false'\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_AUTO_INIT);\n  }\n  if (autoLogAppEvents !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AUTO_LOG_APP_EVENTS,\n      autoLogAppEvents ? 'true' : 'false'\n    );\n  } else {\n    mainApplication = removeMetaDataItemFromMainApplication(\n      mainApplication,\n      META_AUTO_LOG_APP_EVENTS\n    );\n  }\n  if (advertiserIdCollection !== null) {\n    mainApplication = addMetaDataItemToMainApplication(\n      mainApplication,\n      META_AD_ID_COLLECTION,\n      advertiserIdCollection ? 'true' : 'false'\n    );\n  } else {\n    // eslint-disable-next-line\n    mainApplication = removeMetaDataItemFromMainApplication(mainApplication, META_AD_ID_COLLECTION);\n  }\n\n  return androidManifest;\n}\n"],"mappings":"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"}