{"version":3,"file":"withSKAdNetworkIdentifiers.js","names":["withSKAdNetworkIdentifiers","config","identifiers","facebookAppId","getFacebookAppId","ios","infoPlist","Array","isArray","SKAdNetworkItems","existingIds","map","item","SKAdNetworkIdentifier","filter","Boolean","Set","id","lower","toLowerCase","includes","push"],"sources":["../../../../src/plugins/unversioned/expo-facebook/withSKAdNetworkIdentifiers.ts"],"sourcesContent":["import { ConfigPlugin } from '@expo/config-plugins';\n\nimport { getFacebookAppId } from './withIosFacebook';\n\n/**\n * Plugin to add [`SKAdNetworkIdentifier`](https://developer.apple.com/documentation/storekit/skadnetwork/configuring_the_participating_apps)s to the Info.plist safely.\n *\n *\n * @param config\n * @param props.identifiers array of lowercase string ids to push to the `SKAdNetworkItems` array in the `Info.plist`.\n */\nexport const withSKAdNetworkIdentifiers: ConfigPlugin<string[]> = (config, identifiers) => {\n  // Only add the iOS ad network values if facebookAppId is defined.\n  const facebookAppId = getFacebookAppId(config);\n  if (!facebookAppId) {\n    return config;\n  }\n\n  if (!config.ios) {\n    config.ios = {};\n  }\n  if (!config.ios.infoPlist) {\n    config.ios.infoPlist = {};\n  }\n  if (!Array.isArray(config.ios.infoPlist.SKAdNetworkItems)) {\n    config.ios.infoPlist.SKAdNetworkItems = [];\n  }\n\n  // Get ids\n  let existingIds = config.ios.infoPlist.SKAdNetworkItems.map(\n    (item: any) => item?.SKAdNetworkIdentifier ?? null\n  ).filter(Boolean) as string[];\n  // remove duplicates\n  existingIds = [...new Set(existingIds)];\n\n  for (const id of identifiers) {\n    // Must be lowercase\n    const lower = id.toLowerCase();\n    if (!existingIds.includes(lower)) {\n      config.ios.infoPlist.SKAdNetworkItems.push({\n        SKAdNetworkIdentifier: lower,\n      });\n    }\n  }\n\n  return config;\n};\n"],"mappings":";;;;;;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMA,0BAAkD,GAAG,CAACC,MAAM,EAAEC,WAAW,KAAK;EACzF;EACA,MAAMC,aAAa,GAAG,IAAAC,mCAAgB,EAACH,MAAM,CAAC;EAC9C,IAAI,CAACE,aAAa,EAAE;IAClB,OAAOF,MAAM;EACf;EAEA,IAAI,CAACA,MAAM,CAACI,GAAG,EAAE;IACfJ,MAAM,CAACI,GAAG,GAAG,CAAC,CAAC;EACjB;EACA,IAAI,CAACJ,MAAM,CAACI,GAAG,CAACC,SAAS,EAAE;IACzBL,MAAM,CAACI,GAAG,CAACC,SAAS,GAAG,CAAC,CAAC;EAC3B;EACA,IAAI,CAACC,KAAK,CAACC,OAAO,CAACP,MAAM,CAACI,GAAG,CAACC,SAAS,CAACG,gBAAgB,CAAC,EAAE;IACzDR,MAAM,CAACI,GAAG,CAACC,SAAS,CAACG,gBAAgB,GAAG,EAAE;EAC5C;;EAEA;EACA,IAAIC,WAAW,GAAGT,MAAM,CAACI,GAAG,CAACC,SAAS,CAACG,gBAAgB,CAACE,GAAG,CACxDC,IAAS;IAAA;IAAA,gCAAKA,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEC,qBAAqB,yEAAI,IAAI;EAAA,EACnD,CAACC,MAAM,CAACC,OAAO,CAAa;EAC7B;EACAL,WAAW,GAAG,CAAC,GAAG,IAAIM,GAAG,CAACN,WAAW,CAAC,CAAC;EAEvC,KAAK,MAAMO,EAAE,IAAIf,WAAW,EAAE;IAC5B;IACA,MAAMgB,KAAK,GAAGD,EAAE,CAACE,WAAW,EAAE;IAC9B,IAAI,CAACT,WAAW,CAACU,QAAQ,CAACF,KAAK,CAAC,EAAE;MAChCjB,MAAM,CAACI,GAAG,CAACC,SAAS,CAACG,gBAAgB,CAACY,IAAI,CAAC;QACzCR,qBAAqB,EAAEK;MACzB,CAAC,CAAC;IACJ;EACF;EAEA,OAAOjB,MAAM;AACf,CAAC;AAAC"}