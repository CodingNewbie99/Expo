{"version":3,"file":"file-store.js","names":["_FileStore","data","_interopRequireDefault","require","obj","__esModule","default","debug","ExpoMetroFileStore","FileStore","set","key","value","_value$output","_value$output$","_value$output$$data","_value$output2","_value$output2$","_value$output2$$data","_value$output2$$data$","src","output","code","css","skipCache","path","match","exports"],"sources":["../src/file-store.ts"],"sourcesContent":["import FileStore from 'metro-cache/src/stores/FileStore';\n\nconst debug = require('debug')('expo:metro:cache') as typeof console.log;\n\nexport class ExpoMetroFileStore<T> extends FileStore<T> {\n  async set(key: Buffer, value: any): Promise<void> {\n    const src = value?.output?.[0]?.data?.code;\n    // console.log('CACHE:', value?.output?.[0]?.data?.css);\n    if (value?.output?.[0]?.data?.css?.skipCache) {\n      debug('Skipping caching for CSS file:', value.path);\n      return;\n    }\n    if (src) {\n      // Match `// @metro no-cache` or `/** @metro no-cache`\n      if (src.match(/^(?:[\\s\\t]+)(?:\\/\\/|\\/[*]+)(?:[\\s\\t]+)?@metro\\s(?:[\\s\\t]+)?no-cache/m)) {\n        debug('Skipping caching');\n        return;\n      }\n    }\n    return await super.set(key, value);\n  }\n}\n"],"mappings":";;;;;;AAAA,SAAAA,WAAA;EAAA,MAAAC,IAAA,GAAAC,sBAAA,CAAAC,OAAA;EAAAH,UAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAAyD,SAAAC,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEzD,MAAMG,KAAK,GAAGJ,OAAO,CAAC,OAAO,CAAC,CAAC,kBAAkB,CAAuB;AAEjE,MAAMK,kBAAkB,SAAYC,oBAAS,CAAI;EACtD,MAAMC,GAAGA,CAACC,GAAW,EAAEC,KAAU,EAAiB;IAAA,IAAAC,aAAA,EAAAC,cAAA,EAAAC,mBAAA,EAAAC,cAAA,EAAAC,eAAA,EAAAC,oBAAA,EAAAC,qBAAA;IAChD,MAAMC,GAAG,GAAGR,KAAK,aAALA,KAAK,wBAAAC,aAAA,GAALD,KAAK,CAAES,MAAM,cAAAR,aAAA,wBAAAC,cAAA,GAAbD,aAAA,CAAgB,CAAC,CAAC,cAAAC,cAAA,wBAAAC,mBAAA,GAAlBD,cAAA,CAAoBb,IAAI,cAAAc,mBAAA,uBAAxBA,mBAAA,CAA0BO,IAAI;IAC1C;IACA,IAAIV,KAAK,aAALA,KAAK,gBAAAI,cAAA,GAALJ,KAAK,CAAES,MAAM,cAAAL,cAAA,gBAAAC,eAAA,GAAbD,cAAA,CAAgB,CAAC,CAAC,cAAAC,eAAA,gBAAAC,oBAAA,GAAlBD,eAAA,CAAoBhB,IAAI,cAAAiB,oBAAA,gBAAAC,qBAAA,GAAxBD,oBAAA,CAA0BK,GAAG,cAAAJ,qBAAA,eAA7BA,qBAAA,CAA+BK,SAAS,EAAE;MAC5CjB,KAAK,CAAC,gCAAgC,EAAEK,KAAK,CAACa,IAAI,CAAC;MACnD;IACF;IACA,IAAIL,GAAG,EAAE;MACP;MACA,IAAIA,GAAG,CAACM,KAAK,CAAC,sEAAsE,CAAC,EAAE;QACrFnB,KAAK,CAAC,kBAAkB,CAAC;QACzB;MACF;IACF;IACA,OAAO,MAAM,KAAK,CAACG,GAAG,CAACC,GAAG,EAAEC,KAAK,CAAC;EACpC;AACF;AAACe,OAAA,CAAAnB,kBAAA,GAAAA,kBAAA"}