{"version":3,"file":"asset-transformer.js","names":["_Assets","data","require","_util","_nodePath","_interopRequireDefault","obj","__esModule","default","transform","filename","options","assetRegistryPath","assetDataPlugins","_options","platform","projectRoot","inlineRequires","minify","absolutePath","path","resolve","getAssetData","publicPath","ast","generateAssetCodeFileAst"],"sources":["../../src/transform-worker/asset-transformer.ts"],"sourcesContent":["/**\n * Copyright 2023-present 650 Industries (Expo). All rights reserved.\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * Fork of the upstream transformer, but with modifications made for web production hashing.\n * https://github.com/facebook/metro/blob/412771475c540b6f85d75d9dcd5a39a6e0753582/packages/metro-transform-worker/src/utils/assetTransformer.js#L1\n */\nimport { getAssetData } from 'metro/src/Assets';\nimport { generateAssetCodeFileAst } from 'metro/src/Bundler/util';\nimport { BabelTransformerArgs } from 'metro-babel-transformer';\nimport path from 'node:path';\n\nexport async function transform(\n  { filename, options }: BabelTransformerArgs,\n  assetRegistryPath: string,\n  assetDataPlugins: readonly string[]\n) {\n  options ??= options || {\n    platform: '',\n    projectRoot: '',\n    inlineRequires: false,\n    minify: false,\n  };\n\n  const absolutePath = path.resolve(options.projectRoot, filename);\n\n  const data = await getAssetData(\n    absolutePath,\n    filename,\n    assetDataPlugins,\n    options.platform,\n    options.publicPath\n  );\n\n  return {\n    ast: generateAssetCodeFileAst(assetRegistryPath, data),\n  };\n}\n"],"mappings":";;;;;;AAUA,SAAAA,QAAA;EAAA,MAAAC,IAAA,GAAAC,OAAA;EAAAF,OAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAE,MAAA;EAAA,MAAAF,IAAA,GAAAC,OAAA;EAAAC,KAAA,YAAAA,CAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA,SAAAG,UAAA;EAAA,MAAAH,IAAA,GAAAI,sBAAA,CAAAH,OAAA;EAAAE,SAAA,YAAAA,CAAA;IAAA,OAAAH,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAA6B,SAAAI,uBAAAC,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAb7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAMO,eAAeG,SAASA,CAC7B;EAAEC,QAAQ;EAAEC;AAA8B,CAAC,EAC3CC,iBAAyB,EACzBC,gBAAmC,EACnC;EAAA,IAAAC,QAAA;EACA,CAAAA,QAAA,GAAAH,OAAO,cAAAG,QAAA,cAAAA,QAAA,GAAPH,OAAO,GAAKA,OAAO,IAAI;IACrBI,QAAQ,EAAE,EAAE;IACZC,WAAW,EAAE,EAAE;IACfC,cAAc,EAAE,KAAK;IACrBC,MAAM,EAAE;EACV,CAAC;EAED,MAAMC,YAAY,GAAGC,mBAAI,CAACC,OAAO,CAACV,OAAO,CAACK,WAAW,EAAEN,QAAQ,CAAC;EAEhE,MAAMT,IAAI,GAAG,MAAM,IAAAqB,sBAAY,EAC7BH,YAAY,EACZT,QAAQ,EACRG,gBAAgB,EAChBF,OAAO,CAACI,QAAQ,EAChBJ,OAAO,CAACY,UAAU,CACnB;EAED,OAAO;IACLC,GAAG,EAAE,IAAAC,gCAAwB,EAACb,iBAAiB,EAAEX,IAAI;EACvD,CAAC;AACH"}