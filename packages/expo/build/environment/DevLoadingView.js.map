{"version":3,"sources":["../../../src/environment/DevLoadingView.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef, useMemo } from 'react';\nimport {\n  Animated,\n  StyleSheet,\n  Text,\n  NativeModules,\n  NativeEventEmitter,\n  UIManager,\n  View,\n} from 'react-native';\n\nexport default function DevLoadingView() {\n  const [isDevLoading, setIsDevLoading] = useState(false);\n  const [isAnimating, setIsAnimating] = useState(false);\n  const translateY = useRef(new Animated.Value(0)).current;\n  const emitter = useMemo<NativeEventEmitter>(() => {\n    try {\n      return new NativeEventEmitter(NativeModules.DevLoadingView);\n    } catch (error) {\n      throw new Error(\n        'Failed to instantiate native emitter in `DevLoadingView` because the native module `DevLoadingView` is undefined: ' +\n          error.message\n      );\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!emitter) return;\n\n    function handleShowMessage({ message }) {\n      // \"Refreshing...\" is the standard fast refresh message and it's the\n      // only time we want to display this overlay.\n      if (message !== 'Refreshing...') {\n        return;\n      }\n\n      // TODO: if we show the refreshing banner and don't get a hide message\n      // for 3 seconds, warn the user that it's taking a while and suggest\n      // they reload\n\n      translateY.setValue(0);\n      setIsDevLoading(true);\n    }\n\n    function handleHide() {\n      // TODO: if we showed the 'refreshing' banner less than 250ms ago, delay\n      // switching to the 'finished' banner\n\n      setIsAnimating(true);\n      setIsDevLoading(false);\n      Animated.timing(translateY, {\n        toValue: 150,\n        delay: 1000,\n        duration: 350,\n        useNativeDriver: true,\n      }).start(({ finished }) => {\n        if (finished) {\n          setIsAnimating(false);\n          translateY.setValue(0);\n        }\n      });\n    }\n\n    emitter.addListener('devLoadingView:showMessage', handleShowMessage);\n    emitter.addListener('devLoadingView:hide', handleHide);\n\n    return function cleanup() {\n      emitter.removeListener('devLoadingView:showMessage', handleShowMessage);\n      emitter.removeListener('devLoadingView:hide', handleHide);\n    };\n  }, [translateY, emitter]);\n\n  if (isDevLoading || isAnimating) {\n    return (\n      <Animated.View\n        style={[styles.animatedContainer, { transform: [{ translateY }] }]}\n        pointerEvents=\"none\">\n        <View style={styles.banner}>\n          <View style={styles.contentContainer}>\n            <View style={{ flexDirection: 'row' }}>\n              <Text style={styles.text}>{isDevLoading ? 'Refreshing...' : 'Refreshed'}</Text>\n            </View>\n\n            <View style={{ flex: 1 }}>\n              <Text style={styles.subtitle}>\n                {isDevLoading ? 'Using Fast Refresh' : \"Don't see your changes? Reload the app\"}\n              </Text>\n            </View>\n          </View>\n        </View>\n      </Animated.View>\n    );\n  } else {\n    return null;\n  }\n}\n\n/**\n * This is a hack to get the safe area insets without explicitly depending on react-native-safe-area-context.\n * The following code is lifted from: https://git.io/Jzk4k\n *\n * TODO: This will need to be updated for Fabric/TurboModules.\n **/\nconst RNCSafeAreaProviderConfig = UIManager.getViewManagerConfig('RNCSafeAreaProvider') as any;\nconst initialWindowMetrics = RNCSafeAreaProviderConfig?.Constants?.initialWindowMetrics as\n  | { insets: { bottom: number } }\n  | undefined;\n\nconst styles = StyleSheet.create({\n  animatedContainer: {\n    position: 'absolute',\n    bottom: 0,\n    left: 0,\n    right: 0,\n    zIndex: 42, // arbitrary\n  },\n  banner: {\n    flex: 1,\n    overflow: 'visible',\n    backgroundColor: 'rgba(0,0,0,0.75)',\n    paddingBottom: initialWindowMetrics?.insets?.bottom ?? 0,\n  },\n  contentContainer: {\n    flex: 1,\n    paddingTop: 10,\n    paddingBottom: 5,\n    alignItems: 'center',\n    justifyContent: 'center',\n    textAlign: 'center',\n  },\n  text: {\n    color: '#fff',\n    fontSize: 15,\n  },\n  subtitle: {\n    color: 'rgba(255,255,255,0.8)',\n  },\n});\n"],"names":["React","useEffect","useState","useRef","useMemo","Animated","StyleSheet","Text","NativeModules","NativeEventEmitter","UIManager","View","RNCSafeAreaProviderConfig","initialWindowMetrics","DevLoadingView","isDevLoading","setIsDevLoading","isAnimating","setIsAnimating","translateY","Value","current","emitter","error","Error","message","handleShowMessage","setValue","handleHide","timing","toValue","delay","duration","useNativeDriver","start","finished","addListener","cleanup","removeListener","style","styles","animatedContainer","transform","pointerEvents","banner","contentContainer","flexDirection","text","flex","subtitle","getViewManagerConfig","Constants","create","position","bottom","left","right","zIndex","overflow","backgroundColor","paddingBottom","insets","paddingTop","alignItems","justifyContent","textAlign","color","fontSize"],"mappings":"AAAA,MAAM,CAACA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,OAAO,QAAQ,CAAO;AACnE,MAAM,GACJC,QAAQ,EACRC,UAAU,EACVC,IAAI,EACJC,aAAa,EACbC,kBAAkB,EAClBC,SAAS,EACTC,IAAI,QACC,CAAc;IA+FQC,GAAoC,EAgB9CC,IAA4B;AA7G/C,MAAM,SAAS,QAAQ,CAACC,cAAc,GAAG,CAAC;IACxC,KAAK,EAAEC,YAAY,EAAEC,eAAe,IAAId,QAAQ,CAAC,KAAK;IACtD,KAAK,EAAEe,WAAW,EAAEC,cAAc,IAAIhB,QAAQ,CAAC,KAAK;IACpD,KAAK,CAACiB,UAAU,GAAGhB,MAAM,CAAC,GAAG,CAACE,QAAQ,CAACe,KAAK,CAAC,CAAC,GAAGC,OAAO;IACxD,KAAK,CAACC,OAAO,GAAGlB,OAAO,KAA2B,CAAC;QACjD,GAAG,CAAC,CAAC;YACH,MAAM,CAAC,GAAG,CAACK,kBAAkB,CAACD,aAAa,CAACM,cAAc;QAC5D,CAAC,CAAC,KAAK,EAAES,KAAK,EAAE,CAAC;YACf,KAAK,CAAC,GAAG,CAACC,KAAK,CACb,CAAoH,sHAClHD,KAAK,CAACE,OAAO;QAEnB,CAAC;IACH,CAAC,EAAE,CAAC,CAAC;IAELxB,SAAS,KAAO,CAAC;QACf,EAAE,GAAGqB,OAAO,EAAE,MAAM;iBAEXI,iBAAiB,CAAC,CAAC,CAACD,OAAO,EAAC,CAAC,EAAE,CAAC;YACvC,EAAoE,AAApE,kEAAoE;YACpE,EAA6C,AAA7C,2CAA6C;YAC7C,EAAE,EAAEA,OAAO,KAAK,CAAe,gBAAE,CAAC;gBAChC,MAAM;YACR,CAAC;YAED,EAAsE,AAAtE,oEAAsE;YACtE,EAAoE,AAApE,kEAAoE;YACpE,EAAc,AAAd,YAAc;YAEdN,UAAU,CAACQ,QAAQ,CAAC,CAAC;YACrBX,eAAe,CAAC,IAAI;QACtB,CAAC;iBAEQY,UAAU,GAAG,CAAC;YACrB,EAAwE,AAAxE,sEAAwE;YACxE,EAAqC,AAArC,mCAAqC;YAErCV,cAAc,CAAC,IAAI;YACnBF,eAAe,CAAC,KAAK;YACrBX,QAAQ,CAACwB,MAAM,CAACV,UAAU,EAAE,CAAC;gBAC3BW,OAAO,EAAE,GAAG;gBACZC,KAAK,EAAE,IAAI;gBACXC,QAAQ,EAAE,GAAG;gBACbC,eAAe,EAAE,IAAI;YACvB,CAAC,EAAEC,KAAK,EAAE,CAAC,CAACC,QAAQ,EAAC,CAAC,GAAK,CAAC;gBAC1B,EAAE,EAAEA,QAAQ,EAAE,CAAC;oBACbjB,cAAc,CAAC,KAAK;oBACpBC,UAAU,CAACQ,QAAQ,CAAC,CAAC;gBACvB,CAAC;YACH,CAAC;QACH,CAAC;QAEDL,OAAO,CAACc,WAAW,CAAC,CAA4B,6BAAEV,iBAAiB;QACnEJ,OAAO,CAACc,WAAW,CAAC,CAAqB,sBAAER,UAAU;QAErD,MAAM,CAAC,QAAQ,CAACS,OAAO,GAAG,CAAC;YACzBf,OAAO,CAACgB,cAAc,CAAC,CAA4B,6BAAEZ,iBAAiB;YACtEJ,OAAO,CAACgB,cAAc,CAAC,CAAqB,sBAAEV,UAAU;QAC1D,CAAC;IACH,CAAC,EAAE,CAACT;QAAAA,UAAU;QAAEG,OAAO;IAAA,CAAC;IAExB,EAAE,EAAEP,YAAY,IAAIE,WAAW,EAAE,CAAC;QAChC,MAAM,mCACHZ,QAAQ,CAACM,IAAI;YACZ4B,KAAK,EAAE,CAACC;gBAAAA,MAAM,CAACC,iBAAiB;gBAAE,CAAC;oBAACC,SAAS,EAAE,CAAC;wBAAA,CAAC;4BAACvB,UAAU;wBAAC,CAAC;oBAAA,CAAC;gBAAC,CAAC;YAAA,CAAC;YAClEwB,aAAa,EAAC,CAAM;6CACnBhC,IAAI;YAAC4B,KAAK,EAAEC,MAAM,CAACI,MAAM;6CACvBjC,IAAI;YAAC4B,KAAK,EAAEC,MAAM,CAACK,gBAAgB;6CACjClC,IAAI;YAAC4B,KAAK,EAAE,CAAC;gBAACO,aAAa,EAAE,CAAK;YAAC,CAAC;6CAClCvC,IAAI;YAACgC,KAAK,EAAEC,MAAM,CAACO,IAAI;WAAGhC,YAAY,GAAG,CAAe,iBAAG,CAAW,gDAGxEJ,IAAI;YAAC4B,KAAK,EAAE,CAAC;gBAACS,IAAI,EAAE,CAAC;YAAC,CAAC;6CACrBzC,IAAI;YAACgC,KAAK,EAAEC,MAAM,CAACS,QAAQ;WACzBlC,YAAY,GAAG,CAAoB,sBAAG,CAAwC;IAO7F,CAAC,MAAM,CAAC;QACN,MAAM,CAAC,IAAI;IACb,CAAC;AACH,CAAC;AAED,EAKI,AALJ;;;;;EAKI,AALJ,EAKI,CACJ,KAAK,CAACH,yBAAyB,GAAGF,SAAS,CAACwC,oBAAoB,CAAC,CAAqB;AACtF,KAAK,CAACrC,oBAAoB,GAAGD,yBAAyB,aAAzBA,yBAAyB,KAAzBA,IAAI,CAAJA,CAAoC,GAApCA,IAAI,CAAJA,CAAoC,IAApCA,GAAoC,GAApCA,yBAAyB,CAAEuC,SAAS,cAApCvC,GAAoC,KAApCA,IAAI,CAAJA,CAAoC,GAApCA,IAAI,CAAJA,CAAoC,GAApCA,GAAoC,CAAEC,oBAAoB;IAgBpEA,IAAoC;AAZvD,KAAK,CAAC2B,MAAM,GAAGlC,UAAU,CAAC8C,MAAM,CAAC,CAAC;IAChCX,iBAAiB,EAAE,CAAC;QAClBY,QAAQ,EAAE,CAAU;QACpBC,MAAM,EAAE,CAAC;QACTC,IAAI,EAAE,CAAC;QACPC,KAAK,EAAE,CAAC;QACRC,MAAM,EAAE,EAAE;IACZ,CAAC;IACDb,MAAM,EAAE,CAAC;QACPI,IAAI,EAAE,CAAC;QACPU,QAAQ,EAAE,CAAS;QACnBC,eAAe,EAAE,CAAkB;QACnCC,aAAa,GAAE/C,IAAoC,GAApCA,oBAAoB,aAApBA,oBAAoB,KAApBA,IAAI,CAAJA,CAA4B,GAA5BA,IAAI,CAAJA,CAA4B,IAA5BA,IAA4B,GAA5BA,oBAAoB,CAAEgD,MAAM,cAA5BhD,IAA4B,KAA5BA,IAAI,CAAJA,CAA4B,GAA5BA,IAAI,CAAJA,CAA4B,GAA5BA,IAA4B,CAAEyC,MAAM,cAApCzC,IAAoC,cAApCA,IAAoC,GAAI,CAAC;IAC1D,CAAC;IACDgC,gBAAgB,EAAE,CAAC;QACjBG,IAAI,EAAE,CAAC;QACPc,UAAU,EAAE,EAAE;QACdF,aAAa,EAAE,CAAC;QAChBG,UAAU,EAAE,CAAQ;QACpBC,cAAc,EAAE,CAAQ;QACxBC,SAAS,EAAE,CAAQ;IACrB,CAAC;IACDlB,IAAI,EAAE,CAAC;QACLmB,KAAK,EAAE,CAAM;QACbC,QAAQ,EAAE,EAAE;IACd,CAAC;IACDlB,QAAQ,EAAE,CAAC;QACTiB,KAAK,EAAE,CAAuB;IAChC,CAAC;AACH,CAAC"}