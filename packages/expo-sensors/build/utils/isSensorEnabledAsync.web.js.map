{"version":3,"file":"isSensorEnabledAsync.web.js","sourceRoot":"","sources":["../../src/utils/isSensorEnabledAsync.web.ts"],"names":[],"mappings":"AAEA,gDAAgD;AAChD,qDAAqD;AACrD,MAAM,CAAC,KAAK,UAAU,4BAA4B,CAChD,SAA0B,EAC1B,OAAgB;IAEhB,IAAI,CAAC,KAAK,EAAE,EAAE;QACZ,OAAO,IAAI,CAAC;KACb;IAED,IAAI;QACF,OAAO,MAAM,sBAAsB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;KACzD;IAAC,OAAO,EAAE,OAAO,EAAE,EAAE;QACpB,MAAM,IAAI,KAAK,CACb,OAAO;YACL,gFAAgF;YAChF,kGAAkG,CACrG,CAAC;KACH;AACH,CAAC;AAED,yCAAyC;AACzC,MAAM,CAAC,KAAK,UAAU,sBAAsB,CAC1C,SAAiB,EACjB,UAAkB,GAAG;IAErB,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QACrC,MAAM,EAAE,GAAG,UAAU,CAAC,GAAG,EAAE;YACzB,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;YAChD,MAAM,CAAC,IAAI,KAAK,CAAC,yBAAyB,SAAS,GAAG,CAAC,CAAC,CAAC;QAC3D,CAAC,EAAE,OAAO,CAAC,CAAC;QAEZ,MAAM,QAAQ,GAAG,GAAS,EAAE;YAC1B,YAAY,CAAC,EAAE,CAAC,CAAC;YACjB,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;YAChD,OAAO,CAAC,IAAI,CAAC,CAAC;QAChB,CAAC,CAAC;QAEF,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;IAC/C,CAAC,CAAC,CAAC;AACL,CAAC;AAED,8CAA8C;AAC9C,SAAS,KAAK;IACZ,MAAM,KAAK,GAAG,qBAAqB,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;IAC9D,MAAM,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IACpC,OAAO,KAAK,IAAI,CAAC,MAAM,CAAC;AAC1B,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,oBAAoB,CACxC,SAA0B,EAC1B,OAAgB;IAEhB,IAAI;QACF,MAAM,sBAAsB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QACjD,OAAO,IAAI,CAAC;KACb;IAAC,OAAO,KAAK,EAAE;QACd,OAAO,KAAK,CAAC;KACd;AACH,CAAC;AAED,eAAe,oBAAoB,CAAC","sourcesContent":["type SensorEventName = 'deviceorientation' | 'devicemotion';\n\n// iOS 12.2 disables DeviceMotion by default now\n// https://github.com/w3c/deviceorientation/issues/57\nexport async function guardSensorEventEnabledAsync(\n  eventName: SensorEventName,\n  timeout?: number\n): Promise<boolean> {\n  if (!isIOS()) {\n    return true;\n  }\n\n  try {\n    return await guardEventEnabledAsync(eventName, timeout);\n  } catch ({ message }) {\n    throw new Error(\n      message +\n        '\\nEnable device orientation in Settings > Safari > Motion & Orientation Access' +\n        '\\nalso ensure that you are hosting with https as DeviceMotion is now a secure API on iOS Safari.'\n    );\n  }\n}\n\n// throw error if the sensor is disabled.\nexport async function guardEventEnabledAsync(\n  eventName: string,\n  timeout: number = 500\n): Promise<boolean> {\n  return new Promise((resolve, reject) => {\n    const id = setTimeout(() => {\n      window.removeEventListener(eventName, listener);\n      reject(new Error(`Cannot observe event: ${eventName}.`));\n    }, timeout);\n\n    const listener = (): void => {\n      clearTimeout(id);\n      window.removeEventListener(eventName, listener);\n      resolve(true);\n    };\n\n    window.addEventListener(eventName, listener);\n  });\n}\n\n// https://stackoverflow.com/a/9039885/4047926\nfunction isIOS(): boolean {\n  const iosUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  const isIE11 = !!window['MSStream'];\n  return iosUA && !isIE11;\n}\n\nexport async function isSensorEnabledAsync(\n  eventName: SensorEventName,\n  timeout?: number\n): Promise<boolean> {\n  try {\n    await guardEventEnabledAsync(eventName, timeout);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\n\nexport default isSensorEnabledAsync;\n"]}