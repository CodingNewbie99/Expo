{"version":3,"file":"WebCameraUtils.js","sourceRoot":"","sources":["../src/WebCameraUtils.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-env browser */\r\nimport invariant from 'invariant';\r\n\r\nimport {\r\n  CameraType,\r\n  CapturedPicture,\r\n  ImageSize,\r\n  ImageType,\r\n  WebCameraSettings,\r\n  CameraPictureOptions,\r\n} from './Camera.types';\r\nimport * as CapabilityUtils from './WebCapabilityUtils';\r\nimport { CameraTypeToFacingMode, ImageTypeFormat, MinimumConstraints } from './WebConstants';\r\nimport { requestUserMediaAsync } from './WebUserMediaManager';\r\n\r\ninterface ConstrainLongRange {\r\n  max?: number;\r\n  min?: number;\r\n  exact?: number;\r\n  ideal?: number;\r\n}\r\n\r\nexport function getImageSize(videoWidth: number, videoHeight: number, scale: number): ImageSize {\r\n  const width = videoWidth * scale;\r\n  const ratio = videoWidth / width;\r\n  const height = videoHeight / ratio;\r\n\r\n  return {\r\n    width,\r\n    height,\r\n  };\r\n}\r\n\r\nexport function toDataURL(\r\n  canvas: HTMLCanvasElement,\r\n  imageType: ImageType,\r\n  quality: number\r\n): string {\r\n  invariant(\r\n    Object.values(ImageType).includes(imageType),\r\n    `expo-camera: ${imageType} is not a valid ImageType. Expected a string from: ${Object.values(\r\n      ImageType\r\n    ).join(', ')}`\r\n  );\r\n\r\n  const format = ImageTypeFormat[imageType];\r\n  if (imageType === ImageType.jpg) {\r\n    invariant(\r\n      quality <= 1 && quality >= 0,\r\n      `expo-camera: ${quality} is not a valid image quality. Expected a number from 0...1`\r\n    );\r\n    return canvas.toDataURL(format, quality);\r\n  } else {\r\n    return canvas.toDataURL(format);\r\n  }\r\n}\r\n\r\nexport function hasValidConstraints(\r\n  preferredCameraType?: CameraType,\r\n  width?: number | ConstrainLongRange,\r\n  height?: number | ConstrainLongRange\r\n): boolean {\r\n  return preferredCameraType !== undefined && width !== undefined && height !== undefined;\r\n}\r\n\r\nfunction ensureCameraPictureOptions(config: CameraPictureOptions): CameraPictureOptions {\r\n  const captureOptions = {\r\n    scale: 1,\r\n    imageType: ImageType.png,\r\n    isImageMirror: false,\r\n  };\r\n\r\n  for (const key in config) {\r\n    if (key in config && config[key] !== undefined && key in captureOptions) {\r\n      captureOptions[key] = config[key];\r\n    }\r\n  }\r\n  return captureOptions;\r\n}\r\n\r\nconst DEFAULT_QUALITY = 0.92;\r\n\r\nexport function captureImageData(\r\n  video: HTMLVideoElement | null,\r\n  pictureOptions: Pick<CameraPictureOptions, 'scale' | 'isImageMirror'> = {}\r\n): ImageData | null {\r\n  if (!video || video.readyState !== video.HAVE_ENOUGH_DATA) {\r\n    return null;\r\n  }\r\n  const canvas = captureImageContext(video, pictureOptions);\r\n\r\n  const context = canvas.getContext('2d', { alpha: false });\r\n  if (!context || !canvas.width || !canvas.height) {\r\n    return null;\r\n  }\r\n\r\n  const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\r\n  return imageData;\r\n}\r\n\r\nexport function captureImageContext(\r\n  video: HTMLVideoElement,\r\n  { scale = 1, isImageMirror = false }: Pick<CameraPictureOptions, 'scale' | 'isImageMirror'>\r\n): HTMLCanvasElement {\r\n  const { videoWidth, videoHeight } = video;\r\n  const { width, height } = getImageSize(videoWidth, videoHeight, scale!);\r\n\r\n  // Build the canvas size and draw the camera image to the context from video\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  const context = canvas.getContext('2d', { alpha: false });\r\n\r\n  if (!context) {\r\n    // Should never be called\r\n    throw new Error('Context is not defined');\r\n  }\r\n  // sharp image details\r\n  // context.imageSmoothingEnabled = false;\r\n\r\n  // Flip horizontally (as css transform: rotateY(180deg))\r\n  if (isImageMirror) {\r\n    context.setTransform(-1, 0, 0, 1, canvas.width, 0);\r\n  }\r\n\r\n  context.drawImage(video, 0, 0, width, height);\r\n\r\n  return canvas;\r\n}\r\n\r\nexport function captureImage(\r\n  video: HTMLVideoElement,\r\n  pictureOptions: CameraPictureOptions\r\n): string {\r\n  const config = ensureCameraPictureOptions(pictureOptions);\r\n  const canvas = captureImageContext(video, config);\r\n  const { imageType, quality = DEFAULT_QUALITY } = config;\r\n  return toDataURL(canvas, imageType!, quality);\r\n}\r\n\r\nfunction getSupportedConstraints(): MediaTrackSupportedConstraints | null {\r\n  if (navigator.mediaDevices && navigator.mediaDevices.getSupportedConstraints) {\r\n    return navigator.mediaDevices.getSupportedConstraints();\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getIdealConstraints(\r\n  preferredCameraType: CameraType,\r\n  width?: number | ConstrainLongRange,\r\n  height?: number | ConstrainLongRange\r\n): MediaStreamConstraints {\r\n  const preferredConstraints: MediaStreamConstraints = {\r\n    audio: false,\r\n    video: {},\r\n  };\r\n\r\n  if (hasValidConstraints(preferredCameraType, width, height)) {\r\n    return MinimumConstraints;\r\n  }\r\n\r\n  const supports = getSupportedConstraints();\r\n  // TODO(Bacon): Test this\r\n  if (!supports || !supports.facingMode || !supports.width || !supports.height) {\r\n    return MinimumConstraints;\r\n  }\r\n\r\n  if (preferredCameraType && Object.values(CameraType).includes(preferredCameraType)) {\r\n    const facingMode = CameraTypeToFacingMode[preferredCameraType];\r\n    if (isWebKit()) {\r\n      const key = facingMode === 'user' ? 'exact' : 'ideal';\r\n      (preferredConstraints.video as MediaTrackConstraints).facingMode = {\r\n        [key]: facingMode,\r\n      };\r\n    } else {\r\n      (preferredConstraints.video as MediaTrackConstraints).facingMode = {\r\n        ideal: CameraTypeToFacingMode[preferredCameraType],\r\n      };\r\n    }\r\n  }\r\n\r\n  if (isMediaTrackConstraints(preferredConstraints.video)) {\r\n    preferredConstraints.video.width = width;\r\n    preferredConstraints.video.height = height;\r\n  }\r\n\r\n  return preferredConstraints;\r\n}\r\n\r\nfunction isMediaTrackConstraints(input: any): input is MediaTrackConstraints {\r\n  return input && typeof input.video !== 'boolean';\r\n}\r\n\r\n/**\r\n * Invoke getStreamDevice a second time with the opposing camera type if the preferred type cannot be retrieved.\r\n *\r\n * @param preferredCameraType\r\n * @param preferredWidth\r\n * @param preferredHeight\r\n */\r\nexport async function getPreferredStreamDevice(\r\n  preferredCameraType: CameraType,\r\n  preferredWidth?: number | ConstrainLongRange,\r\n  preferredHeight?: number | ConstrainLongRange\r\n): Promise<MediaStream> {\r\n  try {\r\n    return await getStreamDevice(preferredCameraType, preferredWidth, preferredHeight);\r\n  } catch (error) {\r\n    // A hack on desktop browsers to ensure any camera is used.\r\n    // eslint-disable-next-line no-undef\r\n    if (error instanceof OverconstrainedError && error.constraint === 'facingMode') {\r\n      const nextCameraType =\r\n        preferredCameraType === CameraType.back ? CameraType.front : CameraType.back;\r\n      return await getStreamDevice(nextCameraType, preferredWidth, preferredHeight);\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function getStreamDevice(\r\n  preferredCameraType: CameraType,\r\n  preferredWidth?: number | ConstrainLongRange,\r\n  preferredHeight?: number | ConstrainLongRange\r\n): Promise<MediaStream> {\r\n  const constraints: MediaStreamConstraints = getIdealConstraints(\r\n    preferredCameraType,\r\n    preferredWidth,\r\n    preferredHeight\r\n  );\r\n  const stream: MediaStream = await requestUserMediaAsync(constraints);\r\n  return stream;\r\n}\r\n\r\nexport function isWebKit(): boolean {\r\n  return /WebKit/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent);\r\n}\r\n\r\nexport function compareStreams(a: MediaStream | null, b: MediaStream | null): boolean {\r\n  if (!a || !b) {\r\n    return false;\r\n  }\r\n  const settingsA = a.getTracks()[0].getSettings();\r\n  const settingsB = b.getTracks()[0].getSettings();\r\n  return settingsA.deviceId === settingsB.deviceId;\r\n}\r\n\r\nexport function capture(\r\n  video: HTMLVideoElement,\r\n  settings: MediaTrackSettings,\r\n  config: CameraPictureOptions\r\n): CapturedPicture {\r\n  const base64 = captureImage(video, config);\r\n\r\n  const capturedPicture: CapturedPicture = {\r\n    uri: base64,\r\n    base64,\r\n    width: 0,\r\n    height: 0,\r\n  };\r\n\r\n  if (settings) {\r\n    const { width = 0, height = 0 } = settings;\r\n    capturedPicture.width = width;\r\n    capturedPicture.height = height;\r\n    capturedPicture.exif = settings;\r\n  }\r\n\r\n  if (config.onPictureSaved) {\r\n    config.onPictureSaved(capturedPicture);\r\n  }\r\n  return capturedPicture;\r\n}\r\n\r\nexport async function syncTrackCapabilities(\r\n  cameraType: CameraType,\r\n  stream: MediaStream | null,\r\n  settings: WebCameraSettings = {}\r\n): Promise<void> {\r\n  if (stream?.getVideoTracks) {\r\n    await Promise.all(\r\n      stream.getVideoTracks().map(track => onCapabilitiesReady(cameraType, track, settings))\r\n    );\r\n  }\r\n}\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints\r\nasync function onCapabilitiesReady(\r\n  cameraType: CameraType,\r\n  track: MediaStreamTrack,\r\n  settings: WebCameraSettings = {}\r\n): Promise<void> {\r\n  const capabilities = track.getCapabilities();\r\n\r\n  // Create an empty object because if you set a constraint that isn't available an error will be thrown.\r\n  const constraints: MediaTrackConstraintSet = {};\r\n\r\n  // TODO(Bacon): Add `pointsOfInterest` support\r\n  const clampedValues = [\r\n    'exposureCompensation',\r\n    'colorTemperature',\r\n    'iso',\r\n    'brightness',\r\n    'contrast',\r\n    'saturation',\r\n    'sharpness',\r\n    'focusDistance',\r\n    'zoom',\r\n  ];\r\n\r\n  for (const property of clampedValues) {\r\n    if (capabilities[property]) {\r\n      constraints[property] = convertNormalizedSetting(capabilities[property], settings[property]);\r\n    }\r\n  }\r\n\r\n  function validatedInternalConstrainedValue<IConvertedType>(\r\n    constraintKey: string,\r\n    settingsKey: string,\r\n    converter: (settingValue: any) => IConvertedType\r\n  ) {\r\n    const convertedSetting = converter(settings[settingsKey]);\r\n    return validatedConstrainedValue({\r\n      constraintKey,\r\n      settingsKey,\r\n      convertedSetting,\r\n      capabilities,\r\n      settings,\r\n      cameraType,\r\n    });\r\n  }\r\n\r\n  if (capabilities.focusMode && settings.autoFocus !== undefined) {\r\n    constraints.focusMode = validatedInternalConstrainedValue<MediaTrackConstraintSet['focusMode']>(\r\n      'focusMode',\r\n      'autoFocus',\r\n      CapabilityUtils.convertAutoFocusJSONToNative\r\n    );\r\n  }\r\n\r\n  if (capabilities.torch && settings.flashMode !== undefined) {\r\n    constraints.torch = validatedInternalConstrainedValue<MediaTrackConstraintSet['torch']>(\r\n      'torch',\r\n      'flashMode',\r\n      CapabilityUtils.convertFlashModeJSONToNative\r\n    );\r\n  }\r\n\r\n  if (capabilities.whiteBalanceMode && settings.whiteBalance !== undefined) {\r\n    constraints.whiteBalanceMode = validatedInternalConstrainedValue<\r\n      MediaTrackConstraintSet['whiteBalanceMode']\r\n    >('whiteBalanceMode', 'whiteBalance', CapabilityUtils.convertWhiteBalanceJSONToNative);\r\n  }\r\n\r\n  try {\r\n    await track.applyConstraints({ advanced: [constraints] });\r\n  } catch (error) {\r\n    if (__DEV__) console.warn('Failed to apply constraints', error);\r\n  }\r\n}\r\n\r\nexport function stopMediaStream(stream: MediaStream | null) {\r\n  if (!stream) {\r\n    return;\r\n  }\r\n  if (stream.getAudioTracks) {\r\n    stream.getAudioTracks().forEach(track => track.stop());\r\n  }\r\n  if (stream.getVideoTracks) {\r\n    stream.getVideoTracks().forEach(track => track.stop());\r\n  }\r\n  if (isMediaStreamTrack(stream)) {\r\n    stream.stop();\r\n  }\r\n}\r\n\r\nexport function setVideoSource(\r\n  video: HTMLVideoElement,\r\n  stream: MediaStream | MediaSource | Blob | null\r\n): void {\r\n  const createObjectURL = window.URL.createObjectURL ?? window.webkitURL.createObjectURL;\r\n\r\n  if (typeof video.srcObject !== 'undefined') {\r\n    video.srcObject = stream;\r\n  } else if (typeof (video as any).mozSrcObject !== 'undefined') {\r\n    (video as any).mozSrcObject = stream;\r\n  } else if (stream && createObjectURL) {\r\n    video.src = createObjectURL(stream);\r\n  }\r\n\r\n  if (!stream) {\r\n    const revokeObjectURL = window.URL.revokeObjectURL ?? window.webkitURL.revokeObjectURL;\r\n    const source = video.src ?? video.srcObject ?? (video as any).mozSrcObject;\r\n    if (revokeObjectURL && typeof source === 'string') {\r\n      revokeObjectURL(source);\r\n    }\r\n  }\r\n}\r\n\r\nexport function isCapabilityAvailable(video: HTMLVideoElement, keyName: string): boolean {\r\n  const stream = video.srcObject;\r\n\r\n  if (stream instanceof MediaStream) {\r\n    const videoTrack = stream.getVideoTracks()[0];\r\n    return videoTrack.getCapabilities?.()?.[keyName];\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction isMediaStreamTrack(input: any): input is MediaStreamTrack {\r\n  return typeof input.stop === 'function';\r\n}\r\n\r\nfunction convertNormalizedSetting(range: MediaSettingsRange, value?: number): number | undefined {\r\n  if (!value) {\r\n    return;\r\n  }\r\n  // convert the normalized incoming setting to the native camera zoom range\r\n  const converted = convertRange(value, [range.min, range.max]);\r\n  // clamp value so we don't get an error\r\n  return Math.min(range.max, Math.max(range.min, converted));\r\n}\r\n\r\nfunction convertRange(value: number, r2: number[], r1: number[] = [0, 1]): number {\r\n  return ((value - r1[0]) * (r2[1] - r2[0])) / (r1[1] - r1[0]) + r2[0];\r\n}\r\n\r\nfunction validatedConstrainedValue<T>(props: {\r\n  constraintKey: string;\r\n  settingsKey: string;\r\n  convertedSetting: T;\r\n  capabilities: MediaTrackCapabilities;\r\n  settings: WebCameraSettings;\r\n  cameraType: string;\r\n}): T | undefined {\r\n  const {\r\n    constraintKey,\r\n    settingsKey,\r\n    convertedSetting,\r\n    capabilities,\r\n    settings,\r\n    cameraType,\r\n  } = props;\r\n  const setting = settings[settingsKey];\r\n  if (\r\n    Array.isArray(capabilities[constraintKey]) &&\r\n    convertedSetting &&\r\n    !capabilities[constraintKey].includes(convertedSetting)\r\n  ) {\r\n    if (__DEV__) {\r\n      // Only warn in dev mode.\r\n      console.warn(\r\n        ` { ${settingsKey}: \"${setting}\" } (converted to \"${convertedSetting}\" in the browser) is not supported for camera type \"${cameraType}\" in your browser. Using the default value instead.`\r\n      );\r\n    }\r\n    return undefined;\r\n  }\r\n  return convertedSetting;\r\n}\r\n"]}