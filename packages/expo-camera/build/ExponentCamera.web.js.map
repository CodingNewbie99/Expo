{"version":3,"file":"ExponentCamera.web.js","sourceRoot":"","sources":["../src/ExponentCamera.web.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { CSSProperties } from 'react';\r\nimport { findNodeHandle, StyleSheet, View } from 'react-native';\r\nimport { CapturedPicture, NativeProps, PictureOptions, MountError } from './Camera.types';\r\nimport CameraModule, { CameraType } from './CameraModule/CameraModule';\r\nimport CameraManager from './ExponentCameraManager.web';\r\n\r\nexport default class ExponentCamera extends React.Component<NativeProps> {\r\n  video?: number | null;\r\n  camera?: CameraModule;\r\n\r\n  state = { type: null };\r\n\r\n  componentWillUnmount() {\r\n    if (this.camera) {\r\n      this.camera.unmount();\r\n    }\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    this._updateCameraProps(nextProps);\r\n  }\r\n\r\n  _updateCameraProps = async ({\r\n    type,\r\n    zoom,\r\n    pictureSize,\r\n    flashMode,\r\n    autoFocus,\r\n    // focusDepth,\r\n    whiteBalance,\r\n  }: NativeProps) => {\r\n    const { camera } = this;\r\n    if (!camera) {\r\n      return;\r\n    }\r\n    await Promise.all([\r\n      camera.setTypeAsync(type as CameraType),\r\n      camera.setPictureSize(pictureSize as string),\r\n      camera.setZoomAsync(zoom as number),\r\n      camera.setAutoFocusAsync(autoFocus as string),\r\n      camera.setWhiteBalanceAsync(whiteBalance as string),\r\n      camera.setFlashModeAsync(flashMode as string),\r\n      camera.ensureCameraIsRunningAsync(),\r\n    ]);\r\n    const actualCameraType = camera.getActualCameraType();\r\n    if (actualCameraType !== this.state.type) {\r\n      this.setState({ type: actualCameraType });\r\n    }\r\n  };\r\n\r\n  getCamera = (): CameraModule => {\r\n    if (this.camera) {\r\n      return this.camera;\r\n    }\r\n    throw new Error('Camera is not defined yet!');\r\n  };\r\n\r\n  getAvailablePictureSizes = async (ratio: string): Promise<string[]> => {\r\n    const camera = this.getCamera();\r\n    return camera.getAvailablePictureSizes(ratio);\r\n  };\r\n\r\n  takePicture = async (options: PictureOptions): Promise<CapturedPicture> => {\r\n    const camera = this.getCamera();\r\n    return camera.takePicture({\r\n      ...options,\r\n      // This will always be defined, the option gets added to a queue in the upper-level. We should replace the original so it isn't called twice.\r\n      onPictureSaved: this.props.onPictureSaved,\r\n    });\r\n  };\r\n\r\n  resumePreview = async (): Promise<void> => {\r\n    const camera = this.getCamera();\r\n    await camera.resumePreview();\r\n  };\r\n\r\n  pausePreview = (): void => {\r\n    const camera = this.getCamera();\r\n    camera.pausePreview();\r\n  };\r\n\r\n  onCameraReady = () => {\r\n    if (this.props.onCameraReady) {\r\n      this.props.onCameraReady();\r\n    }\r\n  };\r\n\r\n  onMountError = ({ nativeEvent }: { nativeEvent: MountError }) => {\r\n    if (this.props.onMountError) {\r\n      this.props.onMountError({ nativeEvent });\r\n    }\r\n  };\r\n\r\n  _setRef = ref => {\r\n    if (!ref) {\r\n      this.video = null;\r\n      if (this.camera) {\r\n        this.camera.unmount();\r\n        this.camera = undefined;\r\n      }\r\n      return;\r\n    }\r\n    this.video = findNodeHandle(ref);\r\n    this.camera = new CameraModule(ref);\r\n    this.camera.onCameraReady = this.onCameraReady;\r\n    this.camera.onMountError = this.onMountError;\r\n    this._updateCameraProps(this.props);\r\n  };\r\n\r\n  render() {\r\n    const transform = this.state.type === CameraManager.Type.front ? 'rotateY(180deg)' : 'none';\r\n    const style: CSSProperties = {\r\n      position: 'absolute',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      bottom: 0,\r\n      width: '100%',\r\n      height: '100%',\r\n      objectFit: 'cover',\r\n      transform,\r\n    };\r\n\r\n    return (\r\n      <View style={[styles.videoWrapper, this.props.style]}>\r\n        <video ref={this._setRef} style={style} autoPlay playsInline />\r\n        {this.props.children}\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  videoWrapper: {\r\n    flex: 1,\r\n    alignItems: 'stretch',\r\n  },\r\n});\r\n"]}